/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
var t,e,r=9e15,s=1e9,n="0123456789abcdef",i="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",o="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",a={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:r,crypto:!1},u=!0,c="[DecimalError] ",h=c+"Invalid argument: ",l=c+"Precision limit exceeded",f=c+"crypto unavailable",g="[object Decimal]",m=Math.floor,p=Math.pow,w=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,d=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,y=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,b=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,x=1e7,M=i.length-1,v=o.length-1,E={toStringTag:g};function S(t){var e,r,s,n=t.length-1,i="",o=t[0];if(n>0){for(i+=o,e=1;e<n;e++)(r=7-(s=t[e]+"").length)&&(i+=q(r)),i+=s;(r=7-(s=(o=t[e])+"").length)&&(i+=q(r))}else if(0===o)return"0";for(;o%10==0;)o/=10;return i+o}function N(t,e,r){if(t!==~~t||t<e||t>r)throw Error(h+t)}function T(t,e,r,s){var n,i,o,a;for(i=t[0];i>=10;i/=10)--e;return--e<0?(e+=7,n=0):(n=Math.ceil((e+1)/7),e%=7),i=p(10,7-e),a=t[n]%i|0,null==s?e<3?(0==e?a=a/100|0:1==e&&(a=a/10|0),o=r<4&&99999==a||r>3&&49999==a||5e4==a||0==a):o=(r<4&&a+1==i||r>3&&a+1==i/2)&&(t[n+1]/i/100|0)==p(10,e-2)-1||(a==i/2||0==a)&&!(t[n+1]/i/100|0):e<4?(0==e?a=a/1e3|0:1==e?a=a/100|0:2==e&&(a=a/10|0),o=(s||r<4)&&9999==a||!s&&r>3&&4999==a):o=((s||r<4)&&a+1==i||!s&&r>3&&a+1==i/2)&&(t[n+1]/i/1e3|0)==p(10,e-3)-1,o}function $(t,e,r){for(var s,i,o=[0],a=0,u=t.length;a<u;){for(i=o.length;i--;)o[i]*=e;for(o[0]+=n.indexOf(t.charAt(a++)),s=0;s<o.length;s++)o[s]>r-1&&(void 0===o[s+1]&&(o[s+1]=0),o[s+1]+=o[s]/r|0,o[s]%=r)}return o.reverse()}E.absoluteValue=E.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),D(t)},E.ceil=function(){return D(new this.constructor(this),this.e+1,2)},E.clampedTo=E.clamp=function(t,e){var r=this,s=r.constructor;if(t=new s(t),e=new s(e),!t.s||!e.s)return new s(NaN);if(t.gt(e))throw Error(h+e);return r.cmp(t)<0?t:r.cmp(e)>0?e:new s(r)},E.comparedTo=E.cmp=function(t){var e,r,s,n,i=this,o=i.d,a=(t=new i.constructor(t)).d,u=i.s,c=t.s;if(!o||!a)return u&&c?u!==c?u:o===a?0:!o^u<0?1:-1:NaN;if(!o[0]||!a[0])return o[0]?u:a[0]?-c:0;if(u!==c)return u;if(i.e!==t.e)return i.e>t.e^u<0?1:-1;for(e=0,r=(s=o.length)<(n=a.length)?s:n;e<r;++e)if(o[e]!==a[e])return o[e]>a[e]^u<0?1:-1;return s===n?0:s>n^u<0?1:-1},E.cosine=E.cos=function(){var t,r,s=this,n=s.constructor;return s.d?s.d[0]?(t=n.precision,r=n.rounding,n.precision=t+Math.max(s.e,s.sd())+7,n.rounding=1,s=function(t,e){var r,s,n;if(e.isZero())return e;s=e.d.length,s<32?n=(1/U(4,r=Math.ceil(s/3))).toString():(r=16,n="2.3283064365386962890625e-10");t.precision+=r,e=L(t,1,e.times(n),new t(1));for(var i=r;i--;){var o=e.times(e);e=o.times(o).minus(o).times(8).plus(1)}return t.precision-=r,e}(n,Z(n,s)),n.precision=t,n.rounding=r,D(2==e||3==e?s.neg():s,t,r,!0)):new n(1):new n(NaN)},E.cubeRoot=E.cbrt=function(){var t,e,r,s,n,i,o,a,c,h,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(u=!1,(i=l.s*p(l.s*l,1/3))&&Math.abs(i)!=1/0?s=new f(i.toString()):(r=S(l.d),(i=((t=l.e)-r.length+1)%3)&&(r+=1==i||-2==i?"0":"00"),i=p(r,1/3),t=m((t+1)/3)-(t%3==(t<0?-1:2)),(s=new f(r=i==1/0?"5e"+t:(r=i.toExponential()).slice(0,r.indexOf("e")+1)+t)).s=l.s),o=(t=f.precision)+3;;)if(h=(c=(a=s).times(a).times(a)).plus(l),s=R(h.plus(l).times(a),h.plus(c),o+2,1),S(a.d).slice(0,o)===(r=S(s.d)).slice(0,o)){if("9999"!=(r=r.slice(o-3,o+1))&&(n||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(D(s,t+1,1),e=!s.times(s).times(s).eq(l));break}if(!n&&(D(a,t+1,0),a.times(a).times(a).eq(l))){s=a;break}o+=4,n=1}return u=!0,D(s,t,f.rounding,e)},E.decimalPlaces=E.dp=function(){var t,e=this.d,r=NaN;if(e){if(r=7*((t=e.length-1)-m(this.e/7)),t=e[t])for(;t%10==0;t/=10)r--;r<0&&(r=0)}return r},E.dividedBy=E.div=function(t){return R(this,new this.constructor(t))},E.dividedToIntegerBy=E.divToInt=function(t){var e=this.constructor;return D(R(this,new e(t),0,1,1),e.precision,e.rounding)},E.equals=E.eq=function(t){return 0===this.cmp(t)},E.floor=function(){return D(new this.constructor(this),this.e+1,3)},E.greaterThan=E.gt=function(t){return this.cmp(t)>0},E.greaterThanOrEqualTo=E.gte=function(t){var e=this.cmp(t);return 1==e||0===e},E.hyperbolicCosine=E.cosh=function(){var t,e,r,s,n,i=this,o=i.constructor,a=new o(1);if(!i.isFinite())return new o(i.s?1/0:NaN);if(i.isZero())return a;r=o.precision,s=o.rounding,o.precision=r+Math.max(i.e,i.sd())+4,o.rounding=1,(n=i.d.length)<32?e=(1/U(4,t=Math.ceil(n/3))).toString():(t=16,e="2.3283064365386962890625e-10"),i=L(o,1,i.times(e),new o(1),!0);for(var u,c=t,h=new o(8);c--;)u=i.times(i),i=a.minus(u.times(h.minus(u.times(h))));return D(i,o.precision=r,o.rounding=s,!0)},E.hyperbolicSine=E.sinh=function(){var t,e,r,s,n=this,i=n.constructor;if(!n.isFinite()||n.isZero())return new i(n);if(e=i.precision,r=i.rounding,i.precision=e+Math.max(n.e,n.sd())+4,i.rounding=1,(s=n.d.length)<3)n=L(i,2,n,n,!0);else{t=(t=1.4*Math.sqrt(s))>16?16:0|t,n=L(i,2,n=n.times(1/U(5,t)),n,!0);for(var o,a=new i(5),u=new i(16),c=new i(20);t--;)o=n.times(n),n=n.times(a.plus(o.times(u.times(o).plus(c))))}return i.precision=e,i.rounding=r,D(n,e,r,!0)},E.hyperbolicTangent=E.tanh=function(){var t,e,r=this,s=r.constructor;return r.isFinite()?r.isZero()?new s(r):(t=s.precision,e=s.rounding,s.precision=t+7,s.rounding=1,R(r.sinh(),r.cosh(),s.precision=t,s.rounding=e)):new s(r.s)},E.inverseCosine=E.acos=function(){var t=this,e=t.constructor,r=t.abs().cmp(1),s=e.precision,n=e.rounding;return-1!==r?0===r?t.isNeg()?C(e,s,n):new e(0):new e(NaN):t.isZero()?C(e,s+4,n).times(.5):(e.precision=s+6,e.rounding=1,t=new e(1).minus(t).div(t.plus(1)).sqrt().atan(),e.precision=s,e.rounding=n,t.times(2))},E.inverseHyperbolicCosine=E.acosh=function(){var t,e,r=this,s=r.constructor;return r.lte(1)?new s(r.eq(1)?0:NaN):r.isFinite()?(t=s.precision,e=s.rounding,s.precision=t+Math.max(Math.abs(r.e),r.sd())+4,s.rounding=1,u=!1,r=r.times(r).minus(1).sqrt().plus(r),u=!0,s.precision=t,s.rounding=e,r.ln()):new s(r)},E.inverseHyperbolicSine=E.asinh=function(){var t,e,r=this,s=r.constructor;return!r.isFinite()||r.isZero()?new s(r):(t=s.precision,e=s.rounding,s.precision=t+2*Math.max(Math.abs(r.e),r.sd())+6,s.rounding=1,u=!1,r=r.times(r).plus(1).sqrt().plus(r),u=!0,s.precision=t,s.rounding=e,r.ln())},E.inverseHyperbolicTangent=E.atanh=function(){var t,e,r,s,n=this,i=n.constructor;return n.isFinite()?n.e>=0?new i(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(t=i.precision,e=i.rounding,s=n.sd(),Math.max(s,t)<2*-n.e-1?D(new i(n),t,e,!0):(i.precision=r=s-n.e,n=R(n.plus(1),new i(1).minus(n),r+t,1),i.precision=t+4,i.rounding=1,n=n.ln(),i.precision=t,i.rounding=e,n.times(.5))):new i(NaN)},E.inverseSine=E.asin=function(){var t,e,r,s,n=this,i=n.constructor;return n.isZero()?new i(n):(e=n.abs().cmp(1),r=i.precision,s=i.rounding,-1!==e?0===e?((t=C(i,r+4,s).times(.5)).s=n.s,t):new i(NaN):(i.precision=r+6,i.rounding=1,n=n.div(new i(1).minus(n.times(n)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=s,n.times(2)))},E.inverseTangent=E.atan=function(){var t,e,r,s,n,i,o,a,c,h=this,l=h.constructor,f=l.precision,g=l.rounding;if(h.isFinite()){if(h.isZero())return new l(h);if(h.abs().eq(1)&&f+4<=v)return(o=C(l,f+4,g).times(.25)).s=h.s,o}else{if(!h.s)return new l(NaN);if(f+4<=v)return(o=C(l,f+4,g).times(.5)).s=h.s,o}for(l.precision=a=f+10,l.rounding=1,t=r=Math.min(28,a/7+2|0);t;--t)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(u=!1,e=Math.ceil(a/7),s=1,c=h.times(h),o=new l(h),n=h;-1!==t;)if(n=n.times(c),i=o.minus(n.div(s+=2)),n=n.times(c),void 0!==(o=i.plus(n.div(s+=2))).d[e])for(t=e;o.d[t]===i.d[t]&&t--;);return r&&(o=o.times(2<<r-1)),u=!0,D(o,l.precision=f,l.rounding=g,!0)},E.isFinite=function(){return!!this.d},E.isInteger=E.isInt=function(){return!!this.d&&m(this.e/7)>this.d.length-2},E.isNaN=function(){return!this.s},E.isNegative=E.isNeg=function(){return this.s<0},E.isPositive=E.isPos=function(){return this.s>0},E.isZero=function(){return!!this.d&&0===this.d[0]},E.lessThan=E.lt=function(t){return this.cmp(t)<0},E.lessThanOrEqualTo=E.lte=function(t){return this.cmp(t)<1},E.logarithm=E.log=function(t){var e,r,s,n,i,o,a,c,h=this,l=h.constructor,f=l.precision,g=l.rounding;if(null==t)t=new l(10),e=!0;else{if(r=(t=new l(t)).d,t.s<0||!r||!r[0]||t.eq(1))return new l(NaN);e=t.eq(10)}if(r=h.d,h.s<0||!r||!r[0]||h.eq(1))return new l(r&&!r[0]?-1/0:1!=h.s?NaN:r?0:1/0);if(e)if(r.length>1)i=!0;else{for(n=r[0];n%10==0;)n/=10;i=1!==n}if(u=!1,o=Y(h,a=f+5),s=e?I(l,a+10):Y(t,a),T((c=R(o,s,a,1)).d,n=f,g))do{if(o=Y(h,a+=10),s=e?I(l,a+10):Y(t,a),c=R(o,s,a,1),!i){+S(c.d).slice(n+1,n+15)+1==1e14&&(c=D(c,f+1,0));break}}while(T(c.d,n+=10,g));return u=!0,D(c,f,g)},E.minus=E.sub=function(t){var e,r,s,n,i,o,a,c,h,l,f,g,p=this,w=p.constructor;if(t=new w(t),!p.d||!t.d)return p.s&&t.s?p.d?t.s=-t.s:t=new w(t.d||p.s!==t.s?p:NaN):t=new w(NaN),t;if(p.s!=t.s)return t.s=-t.s,p.plus(t);if(h=p.d,g=t.d,a=w.precision,c=w.rounding,!h[0]||!g[0]){if(g[0])t.s=-t.s;else{if(!h[0])return new w(3===c?-0:0);t=new w(p)}return u?D(t,a,c):t}if(r=m(t.e/7),l=m(p.e/7),h=h.slice(),i=l-r){for((f=i<0)?(e=h,i=-i,o=g.length):(e=g,r=l,o=h.length),i>(s=Math.max(Math.ceil(a/7),o)+2)&&(i=s,e.length=1),e.reverse(),s=i;s--;)e.push(0);e.reverse()}else{for((f=(s=h.length)<(o=g.length))&&(o=s),s=0;s<o;s++)if(h[s]!=g[s]){f=h[s]<g[s];break}i=0}for(f&&(e=h,h=g,g=e,t.s=-t.s),o=h.length,s=g.length-o;s>0;--s)h[o++]=0;for(s=g.length;s>i;){if(h[--s]<g[s]){for(n=s;n&&0===h[--n];)h[n]=x-1;--h[n],h[s]+=x}h[s]-=g[s]}for(;0===h[--o];)h.pop();for(;0===h[0];h.shift())--r;return h[0]?(t.d=h,t.e=A(h,r),u?D(t,a,c):t):new w(3===c?-0:0)},E.modulo=E.mod=function(t){var e,r=this,s=r.constructor;return t=new s(t),!r.d||!t.s||t.d&&!t.d[0]?new s(NaN):!t.d||r.d&&!r.d[0]?D(new s(r),s.precision,s.rounding):(u=!1,9==s.modulo?(e=R(r,t.abs(),0,3,1)).s*=t.s:e=R(r,t,0,s.modulo,1),e=e.times(t),u=!0,r.minus(e))},E.naturalExponential=E.exp=function(){return _(this)},E.naturalLogarithm=E.ln=function(){return Y(this)},E.negated=E.neg=function(){var t=new this.constructor(this);return t.s=-t.s,D(t)},E.plus=E.add=function(t){var e,r,s,n,i,o,a,c,h,l,f=this,g=f.constructor;if(t=new g(t),!f.d||!t.d)return f.s&&t.s?f.d||(t=new g(t.d||f.s===t.s?f:NaN)):t=new g(NaN),t;if(f.s!=t.s)return t.s=-t.s,f.minus(t);if(h=f.d,l=t.d,a=g.precision,c=g.rounding,!h[0]||!l[0])return l[0]||(t=new g(f)),u?D(t,a,c):t;if(i=m(f.e/7),s=m(t.e/7),h=h.slice(),n=i-s){for(n<0?(r=h,n=-n,o=l.length):(r=l,s=i,o=h.length),n>(o=(i=Math.ceil(a/7))>o?i+1:o+1)&&(n=o,r.length=1),r.reverse();n--;)r.push(0);r.reverse()}for((o=h.length)-(n=l.length)<0&&(n=o,r=l,l=h,h=r),e=0;n;)e=(h[--n]=h[n]+l[n]+e)/x|0,h[n]%=x;for(e&&(h.unshift(e),++s),o=h.length;0==h[--o];)h.pop();return t.d=h,t.e=A(h,s),u?D(t,a,c):t},E.precision=E.sd=function(t){var e,r=this;if(void 0!==t&&t!==!!t&&1!==t&&0!==t)throw Error(h+t);return r.d?(e=F(r.d),t&&r.e+1>e&&(e=r.e+1)):e=NaN,e},E.round=function(){var t=this,e=t.constructor;return D(new e(t),t.e+1,e.rounding)},E.sine=E.sin=function(){var t,r,s=this,n=s.constructor;return s.isFinite()?s.isZero()?new n(s):(t=n.precision,r=n.rounding,n.precision=t+Math.max(s.e,s.sd())+7,n.rounding=1,s=function(t,e){var r,s=e.d.length;if(s<3)return e.isZero()?e:L(t,2,e,e);r=(r=1.4*Math.sqrt(s))>16?16:0|r,e=e.times(1/U(5,r)),e=L(t,2,e,e);for(var n,i=new t(5),o=new t(16),a=new t(20);r--;)n=e.times(e),e=e.times(i.plus(n.times(o.times(n).minus(a))));return e}(n,Z(n,s)),n.precision=t,n.rounding=r,D(e>2?s.neg():s,t,r,!0)):new n(NaN)},E.squareRoot=E.sqrt=function(){var t,e,r,s,n,i,o=this,a=o.d,c=o.e,h=o.s,l=o.constructor;if(1!==h||!a||!a[0])return new l(!h||h<0&&(!a||a[0])?NaN:a?o:1/0);for(u=!1,0==(h=Math.sqrt(+o))||h==1/0?(((e=S(a)).length+c)%2==0&&(e+="0"),h=Math.sqrt(e),c=m((c+1)/2)-(c<0||c%2),s=new l(e=h==1/0?"5e"+c:(e=h.toExponential()).slice(0,e.indexOf("e")+1)+c)):s=new l(h.toString()),r=(c=l.precision)+3;;)if(s=(i=s).plus(R(o,i,r+2,1)).times(.5),S(i.d).slice(0,r)===(e=S(s.d)).slice(0,r)){if("9999"!=(e=e.slice(r-3,r+1))&&(n||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(D(s,c+1,1),t=!s.times(s).eq(o));break}if(!n&&(D(i,c+1,0),i.times(i).eq(o))){s=i;break}r+=4,n=1}return u=!0,D(s,c,l.rounding,t)},E.tangent=E.tan=function(){var t,r,s=this,n=s.constructor;return s.isFinite()?s.isZero()?new n(s):(t=n.precision,r=n.rounding,n.precision=t+10,n.rounding=1,(s=s.sin()).s=1,s=R(s,new n(1).minus(s.times(s)).sqrt(),t+10,0),n.precision=t,n.rounding=r,D(2==e||4==e?s.neg():s,t,r,!0)):new n(NaN)},E.times=E.mul=function(t){var e,r,s,n,i,o,a,c,h,l=this,f=l.constructor,g=l.d,p=(t=new f(t)).d;if(t.s*=l.s,!(g&&g[0]&&p&&p[0]))return new f(!t.s||g&&!g[0]&&!p||p&&!p[0]&&!g?NaN:g&&p?0*t.s:t.s/0);for(r=m(l.e/7)+m(t.e/7),(c=g.length)<(h=p.length)&&(i=g,g=p,p=i,o=c,c=h,h=o),i=[],s=o=c+h;s--;)i.push(0);for(s=h;--s>=0;){for(e=0,n=c+s;n>s;)a=i[n]+p[s]*g[n-s-1]+e,i[n--]=a%x|0,e=a/x|0;i[n]=(i[n]+e)%x|0}for(;!i[--o];)i.pop();return e?++r:i.shift(),t.d=i,t.e=A(i,r),u?D(t,f.precision,f.rounding):t},E.toBinary=function(t,e){return B(this,2,t,e)},E.toDecimalPlaces=E.toDP=function(t,e){var r=this,n=r.constructor;return r=new n(r),void 0===t?r:(N(t,0,s),void 0===e?e=n.rounding:N(e,0,8),D(r,t+r.e+1,e))},E.toExponential=function(t,e){var r,n=this,i=n.constructor;return void 0===t?r=k(n,!0):(N(t,0,s),void 0===e?e=i.rounding:N(e,0,8),r=k(n=D(new i(n),t+1,e),!0,t+1)),n.isNeg()&&!n.isZero()?"-"+r:r},E.toFixed=function(t,e){var r,n,i=this,o=i.constructor;return void 0===t?r=k(i):(N(t,0,s),void 0===e?e=o.rounding:N(e,0,8),r=k(n=D(new o(i),t+i.e+1,e),!1,t+n.e+1)),i.isNeg()&&!i.isZero()?"-"+r:r},E.toFraction=function(t){var e,r,s,n,i,o,a,c,l,f,g,m,w=this,d=w.d,y=w.constructor;if(!d)return new y(w);if(l=r=new y(1),s=c=new y(0),o=(i=(e=new y(s)).e=F(d)-w.e-1)%7,e.d[0]=p(10,o<0?7+o:o),null==t)t=i>0?e:l;else{if(!(a=new y(t)).isInt()||a.lt(l))throw Error(h+a);t=a.gt(e)?i>0?e:l:a}for(u=!1,a=new y(S(d)),f=y.precision,y.precision=i=7*d.length*2;g=R(a,e,0,1,1),1!=(n=r.plus(g.times(s))).cmp(t);)r=s,s=n,n=l,l=c.plus(g.times(n)),c=n,n=e,e=a.minus(g.times(n)),a=n;return n=R(t.minus(r),s,0,1,1),c=c.plus(n.times(l)),r=r.plus(n.times(s)),c.s=l.s=w.s,m=R(l,s,i,1).minus(w).abs().cmp(R(c,r,i,1).minus(w).abs())<1?[l,s]:[c,r],y.precision=f,u=!0,m},E.toHexadecimal=E.toHex=function(t,e){return B(this,16,t,e)},E.toNearest=function(t,e){var r=this,s=r.constructor;if(r=new s(r),null==t){if(!r.d)return r;t=new s(1),e=s.rounding}else{if(t=new s(t),void 0===e?e=s.rounding:N(e,0,8),!r.d)return t.s?r:t;if(!t.d)return t.s&&(t.s=r.s),t}return t.d[0]?(u=!1,r=R(r,t,0,e,1).times(t),u=!0,D(r)):(t.s=r.s,r=t),r},E.toNumber=function(){return+this},E.toOctal=function(t,e){return B(this,8,t,e)},E.toPower=E.pow=function(t){var e,r,s,n,i,o,a=this,c=a.constructor,h=+(t=new c(t));if(!(a.d&&t.d&&a.d[0]&&t.d[0]))return new c(p(+a,h));if((a=new c(a)).eq(1))return a;if(s=c.precision,i=c.rounding,t.eq(1))return D(a,s,i);if((e=m(t.e/7))>=t.d.length-1&&(r=h<0?-h:h)<=9007199254740991)return n=P(c,a,r,s),t.s<0?new c(1).div(n):D(n,s,i);if((o=a.s)<0){if(e<t.d.length-1)return new c(NaN);if(1&t.d[e]||(o=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=o,a}return(e=0!=(r=p(+a,h))&&isFinite(r)?new c(r+"").e:m(h*(Math.log("0."+S(a.d))/Math.LN10+a.e+1)))>c.maxE+1||e<c.minE-1?new c(e>0?o/0:0):(u=!1,c.rounding=a.s=1,r=Math.min(12,(e+"").length),(n=_(t.times(Y(a,s+r)),s)).d&&T((n=D(n,s+5,1)).d,s,i)&&(e=s+10,+S((n=D(_(t.times(Y(a,e+r)),e),e+5,1)).d).slice(s+1,s+15)+1==1e14&&(n=D(n,s+1,0))),n.s=o,u=!0,c.rounding=i,D(n,s,i))},E.toPrecision=function(t,e){var r,n=this,i=n.constructor;return void 0===t?r=k(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(N(t,1,s),void 0===e?e=i.rounding:N(e,0,8),r=k(n=D(new i(n),t,e),t<=n.e||n.e<=i.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+r:r},E.toSignificantDigits=E.toSD=function(t,e){var r=this.constructor;return void 0===t?(t=r.precision,e=r.rounding):(N(t,1,s),void 0===e?e=r.rounding:N(e,0,8)),D(new r(this),t,e)},E.toString=function(){var t=this,e=t.constructor,r=k(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+r:r},E.truncated=E.trunc=function(){return D(new this.constructor(this),this.e+1,1)},E.valueOf=E.toJSON=function(){var t=this,e=t.constructor,r=k(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+r:r};var R=function(){function e(t,e,r){var s,n=0,i=t.length;for(t=t.slice();i--;)s=t[i]*e+n,t[i]=s%r|0,n=s/r|0;return n&&t.unshift(n),t}function r(t,e,r,s){var n,i;if(r!=s)i=r>s?1:-1;else for(n=i=0;n<r;n++)if(t[n]!=e[n]){i=t[n]>e[n]?1:-1;break}return i}function s(t,e,r,s){for(var n=0;r--;)t[r]-=n,n=t[r]<e[r]?1:0,t[r]=n*s+t[r]-e[r];for(;!t[0]&&t.length>1;)t.shift()}return function(n,i,o,a,u,c){var h,l,f,g,p,w,d,y,b,M,v,E,S,N,T,$,R,k,A,I,C=n.constructor,F=n.s==i.s?1:-1,q=n.d,P=i.d;if(!(q&&q[0]&&P&&P[0]))return new C(n.s&&i.s&&(q?!P||q[0]!=P[0]:P)?q&&0==q[0]||!P?0*F:F/0:NaN);for(c?(p=1,l=n.e-i.e):(c=x,p=7,l=m(n.e/p)-m(i.e/p)),A=P.length,R=q.length,M=(b=new C(F)).d=[],f=0;P[f]==(q[f]||0);f++);if(P[f]>(q[f]||0)&&l--,null==o?(N=o=C.precision,a=C.rounding):N=u?o+(n.e-i.e)+1:o,N<0)M.push(1),w=!0;else{if(N=N/p+2|0,f=0,1==A){for(g=0,P=P[0],N++;(f<R||g)&&N--;f++)T=g*c+(q[f]||0),M[f]=T/P|0,g=T%P|0;w=g||f<R}else{for((g=c/(P[0]+1)|0)>1&&(P=e(P,g,c),q=e(q,g,c),A=P.length,R=q.length),$=A,E=(v=q.slice(0,A)).length;E<A;)v[E++]=0;(I=P.slice()).unshift(0),k=P[0],P[1]>=c/2&&++k;do{g=0,(h=r(P,v,A,E))<0?(S=v[0],A!=E&&(S=S*c+(v[1]||0)),(g=S/k|0)>1?(g>=c&&(g=c-1),1==(h=r(d=e(P,g,c),v,y=d.length,E=v.length))&&(g--,s(d,A<y?I:P,y,c))):(0==g&&(h=g=1),d=P.slice()),(y=d.length)<E&&d.unshift(0),s(v,d,E,c),-1==h&&(h=r(P,v,A,E=v.length))<1&&(g++,s(v,A<E?I:P,E,c)),E=v.length):0===h&&(g++,v=[0]),M[f++]=g,h&&v[0]?v[E++]=q[$]||0:(v=[q[$]],E=1)}while(($++<R||void 0!==v[0])&&N--);w=void 0!==v[0]}M[0]||M.shift()}if(1==p)b.e=l,t=w;else{for(f=1,g=M[0];g>=10;g/=10)f++;b.e=f+l*p-1,D(b,u?o+b.e+1:o,a,w)}return b}}();function D(t,e,r,s){var n,i,o,a,c,h,l,f,g,m=t.constructor;t:if(null!=e){if(!(f=t.d))return t;for(n=1,a=f[0];a>=10;a/=10)n++;if((i=e-n)<0)i+=7,o=e,c=(l=f[g=0])/p(10,n-o-1)%10|0;else if((g=Math.ceil((i+1)/7))>=(a=f.length)){if(!s)break t;for(;a++<=g;)f.push(0);l=c=0,n=1,o=(i%=7)-7+1}else{for(l=a=f[g],n=1;a>=10;a/=10)n++;c=(o=(i%=7)-7+n)<0?0:l/p(10,n-o-1)%10|0}if(s=s||e<0||void 0!==f[g+1]||(o<0?l:l%p(10,n-o-1)),h=r<4?(c||s)&&(0==r||r==(t.s<0?3:2)):c>5||5==c&&(4==r||s||6==r&&(i>0?o>0?l/p(10,n-o):0:f[g-1])%10&1||r==(t.s<0?8:7)),e<1||!f[0])return f.length=0,h?(e-=t.e+1,f[0]=p(10,(7-e%7)%7),t.e=-e||0):f[0]=t.e=0,t;if(0==i?(f.length=g,a=1,g--):(f.length=g+1,a=p(10,7-i),f[g]=o>0?(l/p(10,n-o)%p(10,o)|0)*a:0),h)for(;;){if(0==g){for(i=1,o=f[0];o>=10;o/=10)i++;for(o=f[0]+=a,a=1;o>=10;o/=10)a++;i!=a&&(t.e++,f[0]==x&&(f[0]=1));break}if(f[g]+=a,f[g]!=x)break;f[g--]=0,a=1}for(i=f.length;0===f[--i];)f.pop()}return u&&(t.e>m.maxE?(t.d=null,t.e=NaN):t.e<m.minE&&(t.e=0,t.d=[0])),t}function k(t,e,r){if(!t.isFinite())return j(t);var s,n=t.e,i=S(t.d),o=i.length;return e?(r&&(s=r-o)>0?i=i.charAt(0)+"."+i.slice(1)+q(s):o>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(t.e<0?"e":"e+")+t.e):n<0?(i="0."+q(-n-1)+i,r&&(s=r-o)>0&&(i+=q(s))):n>=o?(i+=q(n+1-o),r&&(s=r-n-1)>0&&(i=i+"."+q(s))):((s=n+1)<o&&(i=i.slice(0,s)+"."+i.slice(s)),r&&(s=r-o)>0&&(n+1===o&&(i+="."),i+=q(s))),i}function A(t,e){var r=t[0];for(e*=7;r>=10;r/=10)e++;return e}function I(t,e,r){if(e>M)throw u=!0,r&&(t.precision=r),Error(l);return D(new t(i),e,1,!0)}function C(t,e,r){if(e>v)throw Error(l);return D(new t(o),e,r,!0)}function F(t){var e=t.length-1,r=7*e+1;if(e=t[e]){for(;e%10==0;e/=10)r--;for(e=t[0];e>=10;e/=10)r++}return r}function q(t){for(var e="";t--;)e+="0";return e}function P(t,e,r,s){var n,i=new t(1),o=Math.ceil(s/7+4);for(u=!1;;){if(r%2&&W((i=i.times(e)).d,o)&&(n=!0),0===(r=m(r/2))){r=i.d.length-1,n&&0===i.d[r]&&++i.d[r];break}W((e=e.times(e)).d,o)}return u=!0,i}function O(t){return 1&t.d[t.d.length-1]}function V(t,e,r){for(var s,n,i=new t(e[0]),o=0;++o<e.length;){if(!(n=new t(e[o])).s){i=n;break}((s=i.cmp(n))===r||0===s&&i.s===r)&&(i=n)}return i}function _(t,e){var r,s,n,i,o,a,c,h=0,l=0,f=0,g=t.constructor,m=g.rounding,w=g.precision;if(!t.d||!t.d[0]||t.e>17)return new g(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:NaN);for(null==e?(u=!1,c=w):c=e,a=new g(.03125);t.e>-2;)t=t.times(a),f+=5;for(c+=s=Math.log(p(2,f))/Math.LN10*2+5|0,r=i=o=new g(1),g.precision=c;;){if(i=D(i.times(t),c,1),r=r.times(++l),S((a=o.plus(R(i,r,c,1))).d).slice(0,c)===S(o.d).slice(0,c)){for(n=f;n--;)o=D(o.times(o),c,1);if(null!=e)return g.precision=w,o;if(!(h<3&&T(o.d,c-s,m,h)))return D(o,g.precision=w,m,u=!0);g.precision=c+=10,r=i=a=new g(1),l=0,h++}o=a}}function Y(t,e){var r,s,n,i,o,a,c,h,l,f,g,m=1,p=t,w=p.d,d=p.constructor,y=d.rounding,b=d.precision;if(p.s<0||!w||!w[0]||!p.e&&1==w[0]&&1==w.length)return new d(w&&!w[0]?-1/0:1!=p.s?NaN:w?0:p);if(null==e?(u=!1,l=b):l=e,d.precision=l+=10,s=(r=S(w)).charAt(0),!(Math.abs(i=p.e)<15e14))return h=I(d,l+2,b).times(i+""),p=Y(new d(s+"."+r.slice(1)),l-10).plus(h),d.precision=b,null==e?D(p,b,y,u=!0):p;for(;s<7&&1!=s||1==s&&r.charAt(1)>3;)s=(r=S((p=p.times(t)).d)).charAt(0),m++;for(i=p.e,s>1?(p=new d("0."+r),i++):p=new d(s+"."+r.slice(1)),f=p,c=o=p=R(p.minus(1),p.plus(1),l,1),g=D(p.times(p),l,1),n=3;;){if(o=D(o.times(g),l,1),S((h=c.plus(R(o,new d(n),l,1))).d).slice(0,l)===S(c.d).slice(0,l)){if(c=c.times(2),0!==i&&(c=c.plus(I(d,l+2,b).times(i+""))),c=R(c,new d(m),l,1),null!=e)return d.precision=b,c;if(!T(c.d,l-10,y,a))return D(c,d.precision=b,y,u=!0);d.precision=l+=10,h=o=p=R(f.minus(1),f.plus(1),l,1),g=D(p.times(p),l,1),n=a=1}c=h,n+=2}}function j(t){return String(t.s*t.s/0)}function z(t,e){var r,s,n;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(s=e.search(/e/i))>0?(r<0&&(r=s),r+=+e.slice(s+1),e=e.substring(0,s)):r<0&&(r=e.length),s=0;48===e.charCodeAt(s);s++);for(n=e.length;48===e.charCodeAt(n-1);--n);if(e=e.slice(s,n)){if(n-=s,t.e=r=r-s-1,t.d=[],s=(r+1)%7,r<0&&(s+=7),s<n){for(s&&t.d.push(+e.slice(0,s)),n-=7;s<n;)t.d.push(+e.slice(s,s+=7));s=7-(e=e.slice(s)).length}else s-=n;for(;s--;)e+="0";t.d.push(+e),u&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function H(t,e){var r,s,n,i,o,a,c,l,f;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),b.test(e))return z(t,e)}else if("Infinity"===e||"NaN"===e)return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(d.test(e))r=16,e=e.toLowerCase();else if(w.test(e))r=2;else{if(!y.test(e))throw Error(h+e);r=8}for((i=e.search(/p/i))>0?(c=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),o=(i=e.indexOf("."))>=0,s=t.constructor,o&&(i=(a=(e=e.replace(".","")).length)-i,n=P(s,new s(r),i,2*i)),i=f=(l=$(e,r,x)).length-1;0===l[i];--i)l.pop();return i<0?new s(0*t.s):(t.e=A(l,f),t.d=l,u=!1,o&&(t=R(t,n,4*a)),c&&(t=t.times(Math.abs(c)<54?p(2,c):qt.pow(2,c))),u=!0,t)}function L(t,e,r,s,n){var i,o,a,c,h=t.precision,l=Math.ceil(h/7);for(u=!1,c=r.times(r),a=new t(s);;){if(o=R(a.times(c),new t(e++*e++),h,1),a=n?s.plus(o):s.minus(o),s=R(o.times(c),new t(e++*e++),h,1),void 0!==(o=a.plus(s)).d[l]){for(i=l;o.d[i]===a.d[i]&&i--;);if(-1==i)break}i=a,a=s,s=o,o=i}return u=!0,o.d.length=l+1,o}function U(t,e){for(var r=t;--e;)r*=t;return r}function Z(t,r){var s,n=r.s<0,i=C(t,t.precision,1),o=i.times(.5);if((r=r.abs()).lte(o))return e=n?4:1,r;if((s=r.divToInt(i)).isZero())e=n?3:2;else{if((r=r.minus(s.times(i))).lte(o))return e=O(s)?n?2:3:n?4:1,r;e=O(s)?n?1:4:n?3:2}return r.minus(i).abs()}function B(e,r,i,o){var a,u,c,h,l,f,g,m,p,w=e.constructor,d=void 0!==i;if(d?(N(i,1,s),void 0===o?o=w.rounding:N(o,0,8)):(i=w.precision,o=w.rounding),e.isFinite()){for(d?(a=2,16==r?i=4*i-3:8==r&&(i=3*i-2)):a=r,(c=(g=k(e)).indexOf("."))>=0&&(g=g.replace(".",""),(p=new w(1)).e=g.length-c,p.d=$(k(p),10,a),p.e=p.d.length),u=l=(m=$(g,10,a)).length;0==m[--l];)m.pop();if(m[0]){if(c<0?u--:((e=new w(e)).d=m,e.e=u,m=(e=R(e,p,i,o,0,a)).d,u=e.e,f=t),c=m[i],h=a/2,f=f||void 0!==m[i+1],f=o<4?(void 0!==c||f)&&(0===o||o===(e.s<0?3:2)):c>h||c===h&&(4===o||f||6===o&&1&m[i-1]||o===(e.s<0?8:7)),m.length=i,f)for(;++m[--i]>a-1;)m[i]=0,i||(++u,m.unshift(1));for(l=m.length;!m[l-1];--l);for(c=0,g="";c<l;c++)g+=n.charAt(m[c]);if(d){if(l>1)if(16==r||8==r){for(c=16==r?4:3,--l;l%c;l++)g+="0";for(l=(m=$(g,a,r)).length;!m[l-1];--l);for(c=1,g="1.";c<l;c++)g+=n.charAt(m[c])}else g=g.charAt(0)+"."+g.slice(1);g=g+(u<0?"p":"p+")+u}else if(u<0){for(;++u;)g="0"+g;g="0."+g}else if(++u>l)for(u-=l;u--;)g+="0";else u<l&&(g=g.slice(0,u)+"."+g.slice(u))}else g=d?"0p+0":"0";g=(16==r?"0x":2==r?"0b":8==r?"0o":"")+g}else g=j(e);return e.s<0?"-"+g:g}function W(t,e){if(t.length>e)return t.length=e,!0}function Q(t){return new this(t).abs()}function K(t){return new this(t).acos()}function J(t){return new this(t).acosh()}function X(t,e){return new this(t).plus(e)}function G(t){return new this(t).asin()}function tt(t){return new this(t).asinh()}function et(t){return new this(t).atan()}function rt(t){return new this(t).atanh()}function st(t,e){t=new this(t),e=new this(e);var r,s=this.precision,n=this.rounding,i=s+4;return t.s&&e.s?t.d||e.d?!e.d||t.isZero()?(r=e.s<0?C(this,s,n):new this(0)).s=t.s:!t.d||e.isZero()?(r=C(this,i,1).times(.5)).s=t.s:e.s<0?(this.precision=i,this.rounding=1,r=this.atan(R(t,e,i,1)),e=C(this,i,1),this.precision=s,this.rounding=n,r=t.s<0?r.minus(e):r.plus(e)):r=this.atan(R(t,e,i,1)):(r=C(this,i,1).times(e.s>0?.25:.75)).s=t.s:r=new this(NaN),r}function nt(t){return new this(t).cbrt()}function it(t){return D(t=new this(t),t.e+1,2)}function ot(t,e,r){return new this(t).clamp(e,r)}function at(t){if(!t||"object"!=typeof t)throw Error(c+"Object expected");var e,n,i,o=!0===t.defaults,u=["precision",1,s,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,r,"maxE",0,r,"minE",-9e15,0,"modulo",0,9];for(e=0;e<u.length;e+=3)if(n=u[e],o&&(this[n]=a[n]),void 0!==(i=t[n])){if(!(m(i)===i&&i>=u[e+1]&&i<=u[e+2]))throw Error(h+n+": "+i);this[n]=i}if(n="crypto",o&&(this[n]=a[n]),void 0!==(i=t[n])){if(!0!==i&&!1!==i&&0!==i&&1!==i)throw Error(h+n+": "+i);if(i){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(f);this[n]=!0}else this[n]=!1}return this}function ut(t){return new this(t).cos()}function ct(t){return new this(t).cosh()}function ht(t,e){return new this(t).div(e)}function lt(t){return new this(t).exp()}function ft(t){return D(t=new this(t),t.e+1,3)}function gt(){var t,e,r=new this(0);for(u=!1,t=0;t<arguments.length;)if((e=new this(arguments[t++])).d)r.d&&(r=r.plus(e.times(e)));else{if(e.s)return u=!0,new this(1/0);r=e}return u=!0,r.sqrt()}function mt(t){return t instanceof qt||t&&t.toStringTag===g||!1}function pt(t){return new this(t).ln()}function wt(t,e){return new this(t).log(e)}function dt(t){return new this(t).log(2)}function yt(t){return new this(t).log(10)}function bt(){return V(this,arguments,-1)}function xt(){return V(this,arguments,1)}function Mt(t,e){return new this(t).mod(e)}function vt(t,e){return new this(t).mul(e)}function Et(t,e){return new this(t).pow(e)}function St(t){var e,r,n,i,o=0,a=new this(1),u=[];if(void 0===t?t=this.precision:N(t,1,s),n=Math.ceil(t/7),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)(i=e[o])>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:u[o++]=i%1e7;else{if(!crypto.randomBytes)throw Error(f);for(e=crypto.randomBytes(n*=4);o<n;)(i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((127&e[o+3])<<24))>=214e7?crypto.randomBytes(4).copy(e,o):(u.push(i%1e7),o+=4);o=n/4}else for(;o<n;)u[o++]=1e7*Math.random()|0;for(t%=7,(n=u[--o])&&t&&(i=p(10,7-t),u[o]=(n/i|0)*i);0===u[o];o--)u.pop();if(o<0)r=0,u=[0];else{for(r=-1;0===u[0];r-=7)u.shift();for(n=1,i=u[0];i>=10;i/=10)n++;n<7&&(r-=7-n)}return a.e=r,a.d=u,a}function Nt(t){return D(t=new this(t),t.e+1,this.rounding)}function Tt(t){return(t=new this(t)).d?t.d[0]?t.s:0*t.s:t.s||NaN}function $t(t){return new this(t).sin()}function Rt(t){return new this(t).sinh()}function Dt(t){return new this(t).sqrt()}function kt(t,e){return new this(t).sub(e)}function At(){var t=0,e=arguments,r=new this(e[t]);for(u=!1;r.s&&++t<e.length;)r=r.plus(e[t]);return u=!0,D(r,this.precision,this.rounding)}function It(t){return new this(t).tan()}function Ct(t){return new this(t).tanh()}function Ft(t){return D(t=new this(t),t.e+1,1)}E[Symbol.for("nodejs.util.inspect.custom")]=E.toString,E[Symbol.toStringTag]="Decimal";var qt=E.constructor=function t(e){var r,s,n;function i(t){var e,r,s,n=this;if(!(n instanceof i))return new i(t);if(n.constructor=i,mt(t))return n.s=t.s,void(u?!t.d||t.e>i.maxE?(n.e=NaN,n.d=null):t.e<i.minE?(n.e=0,n.d=[0]):(n.e=t.e,n.d=t.d.slice()):(n.e=t.e,n.d=t.d?t.d.slice():t.d));if("number"===(s=typeof t)){if(0===t)return n.s=1/t<0?-1:1,n.e=0,void(n.d=[0]);if(t<0?(t=-t,n.s=-1):n.s=1,t===~~t&&t<1e7){for(e=0,r=t;r>=10;r/=10)e++;return void(u?e>i.maxE?(n.e=NaN,n.d=null):e<i.minE?(n.e=0,n.d=[0]):(n.e=e,n.d=[t]):(n.e=e,n.d=[t]))}return 0*t!=0?(t||(n.s=NaN),n.e=NaN,void(n.d=null)):z(n,t.toString())}if("string"===s)return 45===(r=t.charCodeAt(0))?(t=t.slice(1),n.s=-1):(43===r&&(t=t.slice(1)),n.s=1),b.test(t)?z(n,t):H(n,t);if("bigint"===s)return t<0?(t=-t,n.s=-1):n.s=1,z(n,t.toString());throw Error(h+t)}if(i.prototype=E,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=at,i.clone=t,i.isDecimal=mt,i.abs=Q,i.acos=K,i.acosh=J,i.add=X,i.asin=G,i.asinh=tt,i.atan=et,i.atanh=rt,i.atan2=st,i.cbrt=nt,i.ceil=it,i.clamp=ot,i.cos=ut,i.cosh=ct,i.div=ht,i.exp=lt,i.floor=ft,i.hypot=gt,i.ln=pt,i.log=wt,i.log10=yt,i.log2=dt,i.max=bt,i.min=xt,i.mod=Mt,i.mul=vt,i.pow=Et,i.random=St,i.round=Nt,i.sign=Tt,i.sin=$t,i.sinh=Rt,i.sqrt=Dt,i.sub=kt,i.sum=At,i.tan=It,i.tanh=Ct,i.trunc=Ft,void 0===e&&(e={}),e&&!0!==e.defaults)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<n.length;)e.hasOwnProperty(s=n[r++])||(e[s]=this[s]);return i.config(e),i}(a);function Pt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ot(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var s=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,s.get?s:{enumerable:!0,get:function(){return t[e]}})})),r}i=new qt(i),o=new qt(o);var Vt={};const _t=Object.prototype.toString;function Yt(t){const e=_t.call(t);return e.endsWith("Array]")&&!e.includes("Big")}var jt=Ot(Object.freeze({__proto__:null,isAnyArray:Yt}));var zt,Ht=Ot(Object.freeze({__proto__:null,default:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Yt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!Yt(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Yt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[s],a=s+1;a<i;a++)t[a]<o&&(o=t[a]);return o}(t),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Yt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[s],a=s+1;a<i;a++)t[a]>o&&(o=t[a]);return o}(t);if(s===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var i=r.min,o=void 0===i?r.autoMinMax?s:0:i,a=r.max,u=void 0===a?r.autoMinMax?n:1:a;if(o>=u)throw new RangeError("min option must be smaller than max option");for(var c=(u-o)/(n-s),h=0;h<t.length;h++)e[h]=(t[h]-s)*c+o;return e}}));function Lt(){if(zt)return Vt;zt=1,Object.defineProperty(Vt,"__esModule",{value:!0});var t=jt,e=Ht;const r=" ".repeat(2),s=" ".repeat(4);function n(t,e={}){const{maxRows:n=15,maxColumns:o=10,maxNumSize:a=8,padMinus:u="auto"}=e;return`${t.constructor.name} {\n${r}[\n${s}${function(t,e,r,n,o){const{rows:a,columns:u}=t,c=Math.min(a,e),h=Math.min(u,r),l=[];if("auto"===o){o=!1;t:for(let e=0;e<c;e++)for(let r=0;r<h;r++)if(t.get(e,r)<0){o=!0;break t}}for(let e=0;e<c;e++){let r=[];for(let s=0;s<h;s++)r.push(i(t.get(e,s),n,o));l.push(`${r.join(" ")}`)}h!==u&&(l[l.length-1]+=` ... ${u-r} more columns`);c!==a&&l.push(`... ${a-e} more rows`);return l.join(`\n${s}`)}(t,n,o,a,u)}\n${r}]\n${r}rows: ${t.rows}\n${r}columns: ${t.columns}\n}`}function i(t,e,r){return(t>=0&&r?` ${o(t,e-1)}`:o(t,e)).padEnd(e)}function o(t,e){let r=t.toString();if(r.length<=e)return r;let s=t.toFixed(e);if(s.length>e&&(s=t.toFixed(Math.max(0,e-(s.length-e)))),s.length<=e&&!s.startsWith("0.000")&&!s.startsWith("-0.000"))return s;let n=t.toExponential(e);return n.length>e&&(n=t.toExponential(Math.max(0,e-(n.length-e)))),n.slice(0)}function a(t,e,r){let s=r?t.rows:t.rows-1;if(e<0||e>s)throw new RangeError("Row index out of range")}function u(t,e,r){let s=r?t.columns:t.columns-1;if(e<0||e>s)throw new RangeError("Column index out of range")}function c(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function h(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function l(e,r){if(!t.isAnyArray(r))throw new TypeError("row indices must be an array");for(let t=0;t<r.length;t++)if(r[t]<0||r[t]>=e.rows)throw new RangeError("row indices are out of range")}function f(e,r){if(!t.isAnyArray(r))throw new TypeError("column indices must be an array");for(let t=0;t<r.length;t++)if(r[t]<0||r[t]>=e.columns)throw new RangeError("column indices are out of range")}function g(t,e,r,s,n){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(p("startRow",e),p("endRow",r),p("startColumn",s),p("endColumn",n),e>r||s>n||e<0||e>=t.rows||r<0||r>=t.rows||s<0||s>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function m(t,e=0){let r=[];for(let s=0;s<t;s++)r.push(e);return r}function p(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function w(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class d{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let s=new b(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)s.set(n,t,r[n*e+t]);return s}static rowVector(t){let e=new b(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new b(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new b(t,e)}static ones(t,e){return new b(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:s=Math.random}=r;let n=new b(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,s());return n}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:s=0,max:n=1e3,random:i=Math.random}=r;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(s>=n)throw new RangeError("min must be smaller than max");let o=n-s,a=new b(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=s+Math.round(i()*o);a.set(r,t,e)}return a}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let s=Math.min(t,e),n=this.zeros(t,e);for(let t=0;t<s;t++)n.set(t,t,r);return n}static diag(t,e,r){let s=t.length;void 0===e&&(e=s),void 0===r&&(r=e);let n=Math.min(s,e,r),i=this.zeros(e,r);for(let e=0;e<n;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,n=new b(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)n.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return n}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,n=new this(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)n.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return n}static checkMatrix(t){return d.isMatrix(t)?t:new b(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(0!==this.get(t,t))return!1;return!0}isEchelonForm(){let t=0,e=0,r=-1,s=!0,n=!1;for(;t<this.rows&&s;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(s=!1,n=!0);t++}return s}isReducedEchelonForm(){let t=0,e=0,r=-1,s=!0,n=!1;for(;t<this.rows&&s;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(s=!1,n=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let s=e;for(let n=e;n<t.rows;n++)t.get(n,r)>t.get(s,r)&&(s=n);if(0===t.get(s,r))r++;else{t.swapRows(e,s);let n=t.get(e,r);for(let s=r;s<t.columns;s++)t.set(e,s,t.get(e,s)/n);for(let s=e+1;s<t.rows;s++){let n=t.get(s,r)/t.get(e,r);t.set(s,r,0);for(let i=r+1;i<t.columns;i++)t.set(s,i,t.get(s,i)-t.get(e,i)*n)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,s=r-1;for(;s>=0;)if(0===t.maxRow(s))s--;else{let n=0,i=!1;for(;n<r&&!1===i;)1===t.get(s,n)?i=!0:n++;for(let r=0;r<s;r++){let i=t.get(r,n);for(let o=n;o<e;o++){let e=t.get(r,o)-i*t.get(s,o);t.set(r,o,e)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let s=new b(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.setSubMatrix(this,this.rows*t,this.columns*e);return s}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){a(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return b.rowVector(this.getRow(t))}setRow(t,e){a(this,t),e=c(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){a(this,t),a(this,e);for(let r=0;r<this.columns;r++){let s=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,s)}return this}getColumn(t){u(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return b.columnVector(this.getColumn(t))}setColumn(t,e){u(this,t),e=h(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){u(this,t),u(this,e);for(let r=0;r<this.rows;r++){let s=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,s)}return this}addRowVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=h(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=h(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=h(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=h(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){a(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){u(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[e]&&(t[e]=this.get(e,r));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){w(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[e]&&(t[e]=this.get(e,r));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){w(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}maxRow(t){if(a(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){a(this,t),w(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s),r[1]=s);return r}minRow(t){if(a(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){a(this,t),w(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s),r[1]=s);return r}maxColumn(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){u(this,t),w(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>e&&(e=this.get(s,t),r[0]=s);return r}minColumn(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){u(this,t),w(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<e&&(e=this.get(s,t),r[0]=s);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){d.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s];return r}mmul(t){t=b.checkMatrix(t);let e=this.rows,r=this.columns,s=t.columns,n=new b(e,s),i=new Float64Array(r);for(let o=0;o<s;o++){for(let e=0;e<r;e++)i[e]=t.get(e,o);for(let t=0;t<e;t++){let e=0;for(let s=0;s<r;s++)e+=this.get(t,s)*i[s];n.set(t,o,e)}}return n}mpow(t){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(t)||t<0)throw new RangeError("Exponent must be a non-negative integer");let e=b.eye(this.rows),r=this;for(let s=t;s>1;s/=2)1&s&&(e=e.mmul(r)),r=r.mmul(r);return e}strassen2x2(t){t=b.checkMatrix(t);let e=new b(2,2);const r=this.get(0,0),s=t.get(0,0),n=this.get(0,1),i=t.get(0,1),o=this.get(1,0),a=t.get(1,0),u=this.get(1,1),c=t.get(1,1),h=(r+u)*(s+c),l=(o+u)*s,f=r*(i-c),g=u*(a-s),m=(r+n)*c,p=h+g-m+(n-u)*(a+c),w=f+m,d=l+g,y=h-l+f+(o-r)*(s+i);return e.set(0,0,p),e.set(0,1,w),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=b.checkMatrix(t);let e=new b(3,3);const r=this.get(0,0),s=this.get(0,1),n=this.get(0,2),i=this.get(1,0),o=this.get(1,1),a=this.get(1,2),u=this.get(2,0),c=this.get(2,1),h=this.get(2,2),l=t.get(0,0),f=t.get(0,1),g=t.get(0,2),m=t.get(1,0),p=t.get(1,1),w=t.get(1,2),d=t.get(2,0),y=t.get(2,1),x=t.get(2,2),M=(r-i)*(-f+p),v=(-r+i+o)*(l-f+p),E=(i+o)*(-l+f),S=r*l,N=(-r+u+c)*(l-g+w),T=(-r+u)*(g-w),$=(u+c)*(-l+g),R=(-n+c+h)*(p+d-y),D=(n-h)*(p-y),k=n*d,A=(c+h)*(-d+y),I=(-n+o+a)*(w+d-x),C=(n-a)*(w-x),F=(o+a)*(-d+x),q=S+k+s*m,P=(r+s+n-i-o-c-h)*p+v+E+S+R+k+A,O=S+N+$+(r+s+n-o-a-u-c)*w+k+I+F,V=M+o*(-l+f+m-p-w-d+x)+v+S+k+I+C,_=M+v+E+S+a*y,Y=k+I+C+F+i*g,j=S+N+T+c*(-l+g+m-p-w-d+y)+R+D+k,z=R+D+k+A+u*f,H=S+N+T+$+h*x;return e.set(0,0,q),e.set(0,1,P),e.set(0,2,O),e.set(1,0,V),e.set(1,1,_),e.set(1,2,Y),e.set(2,0,j),e.set(2,1,z),e.set(2,2,H),e}mmulStrassen(t){t=b.checkMatrix(t);let e=this.clone(),r=e.rows,s=e.columns,n=t.rows,i=t.columns;function o(t,e,r){let s=t.rows,n=t.columns;if(s===e&&n===r)return t;{let s=d.zeros(e,r);return s=s.setSubMatrix(t,0,0),s}}s!==n&&console.warn(`Multiplying ${r} x ${s} and ${n} x ${i} matrix: dimensions do not match.`);let a=Math.max(r,n),u=Math.max(s,i);return e=o(e,a,u),function t(e,r,s,n){if(s<=512||n<=512)return e.mmul(r);s%2==1&&n%2==1?(e=o(e,s+1,n+1),r=o(r,s+1,n+1)):s%2==1?(e=o(e,s+1,n),r=o(r,s+1,n)):n%2==1&&(e=o(e,s,n+1),r=o(r,s,n+1));let i=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),u=e.subMatrix(0,i-1,0,a-1),c=r.subMatrix(0,i-1,0,a-1),h=e.subMatrix(0,i-1,a,e.columns-1),l=r.subMatrix(0,i-1,a,r.columns-1),f=e.subMatrix(i,e.rows-1,0,a-1),g=r.subMatrix(i,r.rows-1,0,a-1),m=e.subMatrix(i,e.rows-1,a,e.columns-1),p=r.subMatrix(i,r.rows-1,a,r.columns-1),w=t(d.add(u,m),d.add(c,p),i,a),y=t(d.add(f,m),c,i,a),b=t(u,d.sub(l,p),i,a),x=t(m,d.sub(g,c),i,a),M=t(d.add(u,h),p,i,a),v=t(d.sub(f,u),d.add(c,l),i,a),E=t(d.sub(h,m),d.add(g,p),i,a),S=d.add(w,x);S.sub(M),S.add(E);let N=d.add(b,M),T=d.add(y,x),$=d.sub(w,y);$.add(b),$.add(v);let R=d.zeros(2*S.rows,2*S.columns);return R=R.setSubMatrix(S,0,0),R=R.setSubMatrix(N,S.rows,0),R=R.setSubMatrix(T,0,S.columns),R=R.setSubMatrix($,S.rows,S.columns),R.subMatrix(0,s-1,0,n-1)}(e,t=o(t,a,u),a,u)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:r=0,max:s=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(s))throw new TypeError("max must be a number");if(r>=s)throw new RangeError("min must be smaller than max");let n=new b(this.rows,this.columns);for(let t=0;t<this.rows;t++){const i=this.getRow(t);i.length>0&&e(i,{min:r,max:s,output:i}),n.setRow(t,i)}return n}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:r=0,max:s=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(s))throw new TypeError("max must be a number");if(r>=s)throw new RangeError("min must be smaller than max");let n=new b(this.rows,this.columns);for(let t=0;t<this.columns;t++){const i=this.getColumn(t);i.length&&e(i,{min:r,max:s,output:i}),n.setColumn(t,i)}return n}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=b.checkMatrix(t);let e=this.rows,r=this.columns,s=t.rows,n=t.columns,i=new b(e*s,r*n);for(let o=0;o<e;o++)for(let e=0;e<r;e++)for(let r=0;r<s;r++)for(let a=0;a<n;a++)i.set(s*o+r,n*e+a,this.get(o,e)*t.get(r,a));return i}kroneckerSum(t){if(t=b.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,s=this.kroneckerProduct(b.eye(r,r)),n=b.eye(e,e).kroneckerProduct(t);return s.add(n)}transpose(){let t=new b(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=y){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=y){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,s){g(this,t,e,r,s);let n=new b(e-t+1,s-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=s;e++)n.set(i-t,e-r,this.get(i,e));return n}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let s=new b(t.length,r-e+1);for(let n=0;n<t.length;n++)for(let i=e;i<=r;i++){if(t[n]<0||t[n]>=this.rows)throw new RangeError(`Row index out of range: ${t[n]}`);s.set(n,i-e,this.get(t[n],i))}return s}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let s=new b(r-e+1,t.length);for(let n=0;n<t.length;n++)for(let i=e;i<=r;i++){if(t[n]<0||t[n]>=this.columns)throw new RangeError(`Column index out of range: ${t[n]}`);s.set(i-e,n,this.get(i,t[n]))}return s}setSubMatrix(t,e,r){if((t=b.checkMatrix(t)).isEmpty())return this;g(this,e,e+t.rows-1,r,r+t.columns-1);for(let s=0;s<t.rows;s++)for(let n=0;n<t.columns;n++)this.set(e+s,r+n,t.get(s,n));return this}selection(t,e){l(this,t),f(this,e);let r=new b(t.length,e.length);for(let s=0;s<t.length;s++){let n=t[s];for(let t=0;t<e.length;t++){let i=e[t];r.set(s,t,this.get(n,i))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){return this.constructor.copy(this,new b(this.rows,this.columns))}static copy(t,e){for(const[r,s,n]of t.entries())e.set(r,s,n);return e}sum(t){switch(t){case"row":return function(t){let e=m(t.rows);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]+=t.get(r,s);return e}(this);case"column":return function(t){let e=m(t.columns);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]+=t.get(r,s);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e+=t.get(r,s);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=m(t.rows,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]*=t.get(r,s);return e}(this);case"column":return function(t){let e=m(t.columns,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]*=t.get(r,s);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e*=t.get(r,s);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(e,r={}){if("object"==typeof e&&(r=e,e=void 0),"object"!=typeof r)throw new TypeError("options must be an object");const{unbiased:s=!0,mean:n=this.mean(e)}=r;if("boolean"!=typeof s)throw new TypeError("unbiased must be a boolean");switch(e){case"row":if(!t.isAnyArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const s=t.rows,n=t.columns,i=[];for(let o=0;o<s;o++){let s=0,a=0,u=0;for(let e=0;e<n;e++)u=t.get(o,e)-r[o],s+=u,a+=u*u;e?i.push((a-s*s/n)/(n-1)):i.push((a-s*s/n)/n)}return i}(this,s,n);case"column":if(!t.isAnyArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const s=t.rows,n=t.columns,i=[];for(let o=0;o<n;o++){let n=0,a=0,u=0;for(let e=0;e<s;e++)u=t.get(e,o)-r[o],n+=u,a+=u*u;e?i.push((a-n*n/s)/(s-1)):i.push((a-n*n/s)/s)}return i}(this,s,n);case void 0:if("number"!=typeof n)throw new TypeError("mean must be a number");return function(t,e,r){const s=t.rows,n=t.columns,i=s*n;let o=0,a=0,u=0;for(let e=0;e<s;e++)for(let s=0;s<n;s++)u=t.get(e,s)-r,o+=u,a+=u*u;return e?(a-o*o/i)/(i-1):(a-o*o/i)/i}(this,s,n);default:throw new Error(`invalid option: ${e}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(e,r={}){if("object"==typeof e&&(r=e,e=void 0),"object"!=typeof r)throw new TypeError("options must be an object");const{center:s=this.mean(e)}=r;switch(e){case"row":if(!t.isAnyArray(s))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[r])}(this,s),this;case"column":if(!t.isAnyArray(s))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[s])}(this,s),this;case void 0:if("number"!=typeof s)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e)}(this,s),this;default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if("object"==typeof e&&(r=e,e=void 0),"object"!=typeof r)throw new TypeError("options must be an object");let s=r.scale;switch(e){case"row":if(void 0===s)s=function(t){const e=[];for(let r=0;r<t.rows;r++){let s=0;for(let e=0;e<t.columns;e++)s+=t.get(r,e)**2/(t.columns-1);e.push(Math.sqrt(s))}return e}(this);else if(!t.isAnyArray(s))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[r])}(this,s),this;case"column":if(void 0===s)s=function(t){const e=[];for(let r=0;r<t.columns;r++){let s=0;for(let e=0;e<t.rows;e++)s+=t.get(e,r)**2/(t.rows-1);e.push(Math.sqrt(s))}return e}(this);else if(!t.isAnyArray(s))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[s])}(this,s),this;case void 0:if(void 0===s)s=function(t){const e=t.size-1;let r=0;for(let s=0;s<t.columns;s++)for(let n=0;n<t.rows;n++)r+=t.get(n,s)**2/e;return Math.sqrt(r)}(this);else if("number"!=typeof s)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e)}(this,s),this;default:throw new Error(`invalid option: ${e}`)}}toString(t){return n(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}}function y(t,e){return t-e}d.prototype.klass="Matrix","undefined"!=typeof Symbol&&(d.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return n(this)}),d.random=d.rand,d.randomInt=d.randInt,d.diagonal=d.diag,d.prototype.diagonal=d.prototype.diag,d.identity=d.eye,d.prototype.negate=d.prototype.neg,d.prototype.tensorProduct=d.prototype.kroneckerProduct;class b extends d{data;#t(t,e){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e));this.rows=t,this.columns=e}constructor(e,r){if(super(),b.isMatrix(e))this.#t(e.rows,e.columns),b.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#t(e,r);else{if(!t.isAnyArray(e))throw new TypeError("First argument must be a positive number or an array");{const t=e;if("number"!=typeof(r=(e=t.length)?t[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(t[s].length!==r)throw new RangeError("Inconsistent array dimensions");if(!t[s].every((t=>"number"==typeof t)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[s]))}this.rows=e,this.columns=r}}}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return a(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),a(this,t,!0),e=Float64Array.from(c(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){u(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let s=0;s<t;s++)r[s]=this.data[e][s];for(let s=t+1;s<this.columns;s++)r[s-1]=this.data[e][s];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),u(this,t,!0),e=h(this,e);for(let r=0;r<this.rows;r++){const s=new Float64Array(this.columns+1);let n=0;for(;n<t;n++)s[n]=this.data[r][n];for(s[n++]=e[r];n<this.columns+1;n++)s[n]=this.data[r][n-1];this.data[r]=s}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t);return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t.get(e,r));return this}}(d,b);class x extends d{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return b.isMatrix(t)&&"SymmetricMatrix"===t.klassType}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),b.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");this.#e=b.copy(t,new b(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#e=new b(t,t);else if(this.#e=new b(t),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const t=new x(this.diagonalSize);for(const[e,r,s]of this.upperRightEntries())t.set(e,r,s);return t}toMatrix(){return new b(this)}get(t,e){return this.#e.get(t,e)}set(t,e,r){return this.#e.set(t,e,r),this.#e.set(e,t,r),this}removeCross(t){return this.#e.removeRow(t),this.#e.removeColumn(t),this}addCross(t,e){void 0===e&&(e=t,t=this.diagonalSize);const r=e.slice();return r.splice(t,1),this.#e.addRow(t,r),this.#e.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[r,s]of t.entries())s||e.push(r);e.reverse();for(const t of e)this.removeCross(t);return this}toCompact(){const{diagonalSize:t}=this,e=new Array(t*(t+1)/2);for(let r=0,s=0,n=0;n<e.length;n++)e[n]=this.get(s,r),++r>=t&&(r=++s);return e}static fromCompact(t){const e=t.length,r=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const s=new x(r);for(let n=0,i=0,o=0;o<e;o++)s.set(n,i,t[o]),++n>=r&&(n=++i);return s}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;void 0){const r=this.get(t,e);yield[t,e,r],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;void 0){const r=this.get(t,e);yield r,++e>=this.diagonalSize&&(e=++t)}}}x.prototype.klassType="SymmetricMatrix";class M extends x{static isDistanceMatrix(t){return x.isSymmetricMatrix(t)&&"DistanceMatrix"===t.klassSubType}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,r){return t===e&&(r=0),super.set(t,e,r)}addCross(t,e){return void 0===e&&(e=t,t=this.diagonalSize),(e=e.slice())[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new x(this)}clone(){const t=new M(this.diagonalSize);for(const[e,r,s]of this.upperRightEntries())e!==r&&t.set(e,r,s);return t}toCompact(){const{diagonalSize:t}=this,e=new Array((t-1)*t/2);for(let r=1,s=0,n=0;n<e.length;n++)e[n]=this.get(s,r),++r>=t&&(r=1+ ++s);return e}static fromCompact(t){const e=t.length;if(0===e)return new this(0);const r=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const s=new this(r);for(let n=1,i=0,o=0;o<e;o++)s.set(n,i,t[o]),++n>=r&&(n=1+ ++i);return s}}M.prototype.klassSubType="DistanceMatrix";class v extends d{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class E extends v{constructor(t,e,r){l(t,e),f(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class S extends d{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let s=this._calculateIndex(t,e);return this.data[s]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class N extends d{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class T{constructor(t){let e,r,s,n,i,o,a,u,c,h=(t=N.checkMatrix(t)).clone(),l=h.rows,f=h.columns,g=new Float64Array(l),m=1;for(e=0;e<l;e++)g[e]=e;for(u=new Float64Array(l),r=0;r<f;r++){for(e=0;e<l;e++)u[e]=h.get(e,r);for(e=0;e<l;e++){for(c=Math.min(e,r),i=0,s=0;s<c;s++)i+=h.get(e,s)*u[s];u[e]-=i,h.set(e,r,u[e])}for(n=r,e=r+1;e<l;e++)Math.abs(u[e])>Math.abs(u[n])&&(n=e);if(n!==r){for(s=0;s<f;s++)o=h.get(n,s),h.set(n,s,h.get(r,s)),h.set(r,s,o);a=g[n],g[n]=g[r],g[r]=a,m=-m}if(r<l&&0!==h.get(r,r))for(e=r+1;e<l;e++)h.set(e,r,h.get(e,r)/h.get(r,r))}this.LU=h,this.pivotVector=g,this.pivotSign=m}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=b.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,s,n,i=t.columns,o=t.subMatrixRow(this.pivotVector,0,i-1),a=e.columns;for(n=0;n<a;n++)for(r=n+1;r<a;r++)for(s=0;s<i;s++)o.set(r,s,o.get(r,s)-o.get(n,s)*e.get(r,n));for(n=a-1;n>=0;n--){for(s=0;s<i;s++)o.set(n,s,o.get(n,s)/e.get(n,n));for(r=0;r<n;r++)for(s=0;s<i;s++)o.set(r,s,o.get(r,s)-o.get(n,s)*e.get(r,n))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let s=0;s<r;s++)e*=t.get(s,s);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new b(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n>e?s.set(n,e,t.get(n,e)):n===e?s.set(n,e,1):s.set(n,e,0);return s}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new b(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n<=e?s.set(n,e,t.get(n,e)):s.set(n,e,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function $(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class R{constructor(t){let e,r,s,n,i=(t=N.checkMatrix(t)).clone(),o=t.rows,a=t.columns,u=new Float64Array(a);for(s=0;s<a;s++){let t=0;for(e=s;e<o;e++)t=$(t,i.get(e,s));if(0!==t){for(i.get(s,s)<0&&(t=-t),e=s;e<o;e++)i.set(e,s,i.get(e,s)/t);for(i.set(s,s,i.get(s,s)+1),r=s+1;r<a;r++){for(n=0,e=s;e<o;e++)n+=i.get(e,s)*i.get(e,r);for(n=-n/i.get(s,s),e=s;e<o;e++)i.set(e,r,i.get(e,r)+n*i.get(e,s))}}u[s]=-t}this.QR=i,this.Rdiag=u}solve(t){t=b.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s,n,i,o,a=t.columns,u=t.clone(),c=e.columns;for(i=0;i<c;i++)for(n=0;n<a;n++){for(o=0,s=i;s<r;s++)o+=e.get(s,i)*u.get(s,n);for(o=-o/e.get(i,i),s=i;s<r;s++)u.set(s,n,u.get(s,n)+o*e.get(s,i))}for(i=c-1;i>=0;i--){for(n=0;n<a;n++)u.set(i,n,u.get(i,n)/this.Rdiag[i]);for(s=0;s<i;s++)for(n=0;n<a;n++)u.set(s,n,u.get(s,n)-u.get(i,n)*e.get(s,i))}return u.subMatrix(0,c-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,s=r.columns,n=new b(s,s);for(t=0;t<s;t++)for(e=0;e<s;e++)t<e?n.set(t,e,r.get(t,e)):t===e?n.set(t,e,this.Rdiag[t]):n.set(t,e,0);return n}get orthogonalMatrix(){let t,e,r,s,n=this.QR,i=n.rows,o=n.columns,a=new b(i,o);for(r=o-1;r>=0;r--){for(t=0;t<i;t++)a.set(t,r,0);for(a.set(r,r,1),e=r;e<o;e++)if(0!==n.get(r,r)){for(s=0,t=r;t<i;t++)s+=n.get(t,r)*a.get(t,e);for(s=-s/n.get(r,r),t=r;t<i;t++)a.set(t,e,a.get(t,e)+s*n.get(t,r))}}return a}}class D{constructor(t,e={}){if((t=N.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,s=t.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:i=!0,autoTranspose:o=!1}=e;let a,u=Boolean(n),c=Boolean(i),h=!1;if(r<s)if(o){a=t.transpose(),r=a.rows,s=a.columns,h=!0;let e=u;u=c,c=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let l=Math.min(r,s),f=Math.min(r+1,s),g=new Float64Array(f),m=new b(r,l),p=new b(s,s),w=new Float64Array(s),d=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let x=Math.min(r-1,s),M=Math.max(0,Math.min(s-2,r)),v=Math.max(x,M);for(let t=0;t<v;t++){if(t<x){g[t]=0;for(let e=t;e<r;e++)g[t]=$(g[t],a.get(e,t));if(0!==g[t]){a.get(t,t)<0&&(g[t]=-g[t]);for(let e=t;e<r;e++)a.set(e,t,a.get(e,t)/g[t]);a.set(t,t,a.get(t,t)+1)}g[t]=-g[t]}for(let e=t+1;e<s;e++){if(t<x&&0!==g[t]){let s=0;for(let n=t;n<r;n++)s+=a.get(n,t)*a.get(n,e);s=-s/a.get(t,t);for(let n=t;n<r;n++)a.set(n,e,a.get(n,e)+s*a.get(n,t))}w[e]=a.get(t,e)}if(u&&t<x)for(let e=t;e<r;e++)m.set(e,t,a.get(e,t));if(t<M){w[t]=0;for(let e=t+1;e<s;e++)w[t]=$(w[t],w[e]);if(0!==w[t]){w[t+1]<0&&(w[t]=0-w[t]);for(let e=t+1;e<s;e++)w[e]/=w[t];w[t+1]+=1}if(w[t]=-w[t],t+1<r&&0!==w[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<s;r++)d[e]+=w[r]*a.get(e,r);for(let e=t+1;e<s;e++){let s=-w[e]/w[t+1];for(let n=t+1;n<r;n++)a.set(n,e,a.get(n,e)+s*d[n])}}if(c)for(let e=t+1;e<s;e++)p.set(e,t,w[e])}}let E=Math.min(s,r+1);if(x<s&&(g[x]=a.get(x,x)),r<E&&(g[E-1]=0),M+1<E&&(w[M]=a.get(M,E-1)),w[E-1]=0,u){for(let t=x;t<l;t++){for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}for(let t=x-1;t>=0;t--)if(0!==g[t]){for(let e=t+1;e<l;e++){let s=0;for(let n=t;n<r;n++)s+=m.get(n,t)*m.get(n,e);s=-s/m.get(t,t);for(let n=t;n<r;n++)m.set(n,e,m.get(n,e)+s*m.get(n,t))}for(let e=t;e<r;e++)m.set(e,t,-m.get(e,t));m.set(t,t,1+m.get(t,t));for(let e=0;e<t-1;e++)m.set(e,t,0)}else{for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}}if(c)for(let t=s-1;t>=0;t--){if(t<M&&0!==w[t])for(let e=t+1;e<s;e++){let r=0;for(let n=t+1;n<s;n++)r+=p.get(n,t)*p.get(n,e);r=-r/p.get(t+1,t);for(let n=t+1;n<s;n++)p.set(n,e,p.get(n,e)+r*p.get(n,t))}for(let e=0;e<s;e++)p.set(e,t,0);p.set(t,t,1)}let S=E-1,T=Number.EPSILON;for(;E>0;){let t,e;for(t=E-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+T*Math.abs(g[t]+Math.abs(g[t+1]));if(Math.abs(w[t])<=e||Number.isNaN(w[t])){w[t]=0;break}}if(t===E-2)e=4;else{let r;for(r=E-1;r>=t&&r!==t;r--){let e=(r!==E?Math.abs(w[r]):0)+(r!==t+1?Math.abs(w[r-1]):0);if(Math.abs(g[r])<=T*e){g[r]=0;break}}r===t?e=3:r===E-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=w[E-2];w[E-2]=0;for(let r=E-2;r>=t;r--){let n=$(g[r],e),i=g[r]/n,o=e/n;if(g[r]=n,r!==t&&(e=-o*w[r-1],w[r-1]=i*w[r-1]),c)for(let t=0;t<s;t++)n=i*p.get(t,r)+o*p.get(t,E-1),p.set(t,E-1,-o*p.get(t,r)+i*p.get(t,E-1)),p.set(t,r,n)}break}case 2:{let e=w[t-1];w[t-1]=0;for(let s=t;s<E;s++){let n=$(g[s],e),i=g[s]/n,o=e/n;if(g[s]=n,e=-o*w[s],w[s]=i*w[s],u)for(let e=0;e<r;e++)n=i*m.get(e,s)+o*m.get(e,t-1),m.set(e,t-1,-o*m.get(e,s)+i*m.get(e,t-1)),m.set(e,s,n)}break}case 3:{const e=Math.max(Math.abs(g[E-1]),Math.abs(g[E-2]),Math.abs(w[E-2]),Math.abs(g[t]),Math.abs(w[t])),n=g[E-1]/e,i=g[E-2]/e,o=w[E-2]/e,a=g[t]/e,h=w[t]/e,l=((i+n)*(i-n)+o*o)/2,f=n*o*(n*o);let d=0;0===l&&0===f||(d=l<0?0-Math.sqrt(l*l+f):Math.sqrt(l*l+f),d=f/(l+d));let y=(a+n)*(a-n)+d,b=a*h;for(let e=t;e<E-1;e++){let n=$(y,b);0===n&&(n=Number.MIN_VALUE);let i=y/n,o=b/n;if(e!==t&&(w[e-1]=n),y=i*g[e]+o*w[e],w[e]=i*w[e]-o*g[e],b=o*g[e+1],g[e+1]=i*g[e+1],c)for(let t=0;t<s;t++)n=i*p.get(t,e)+o*p.get(t,e+1),p.set(t,e+1,-o*p.get(t,e)+i*p.get(t,e+1)),p.set(t,e,n);if(n=$(y,b),0===n&&(n=Number.MIN_VALUE),i=y/n,o=b/n,g[e]=n,y=i*w[e]+o*g[e+1],g[e+1]=-o*w[e]+i*g[e+1],b=o*w[e+1],w[e+1]=i*w[e+1],u&&e<r-1)for(let t=0;t<r;t++)n=i*m.get(t,e)+o*m.get(t,e+1),m.set(t,e+1,-o*m.get(t,e)+i*m.get(t,e+1)),m.set(t,e,n)}w[E-2]=y;break}case 4:if(g[t]<=0&&(g[t]=g[t]<0?-g[t]:0,c))for(let e=0;e<=S;e++)p.set(e,t,-p.get(e,t));for(;t<S&&!(g[t]>=g[t+1]);){let e=g[t];if(g[t]=g[t+1],g[t+1]=e,c&&t<s-1)for(let r=0;r<s;r++)e=p.get(r,t+1),p.set(r,t+1,p.get(r,t)),p.set(r,t,e);if(u&&t<r-1)for(let s=0;s<r;s++)e=m.get(s,t+1),m.set(s,t+1,m.get(s,t)),m.set(s,t,e);t++}E--}}if(h){let t=p;p=m,m=t}this.m=r,this.n=s,this.s=g,this.U=m,this.V=p}solve(t){let e=t,r=this.threshold,s=this.s.length,n=b.zeros(s,s);for(let t=0;t<s;t++)Math.abs(this.s[t])<=r?n.set(t,t,0):n.set(t,t,1/this.s[t]);let i=this.U,o=this.rightSingularVectors,a=o.mmul(n),u=o.rows,c=i.rows,h=b.zeros(u,c);for(let t=0;t<u;t++)for(let e=0;e<c;e++){let r=0;for(let n=0;n<s;n++)r+=a.get(t,n)*i.get(e,n);h.set(t,e,r)}return h.mmul(e)}solveForDiagonal(t){return this.solve(b.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,s=t.columns,n=new b(r,this.s.length);for(let i=0;i<r;i++)for(let r=0;r<s;r++)Math.abs(this.s[r])>e&&n.set(i,r,t.get(i,r)/this.s[r]);let i=this.U,o=i.rows,a=i.columns,u=new b(r,o);for(let t=0;t<r;t++)for(let e=0;e<o;e++){let r=0;for(let s=0;s<a;s++)r+=n.get(t,s)*i.get(e,s);u.set(t,e,r)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let s=0,n=r.length;s<n;s++)r[s]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return b.diag(this.s)}}function k(t,e,r=!1){return t=N.checkMatrix(t),e=N.checkMatrix(e),r?new D(t).solve(e):t.isSquare()?new T(t).solve(e):new R(t).solve(e)}function A(t,e){let r=[];for(let s=0;s<t;s++)s!==e&&r.push(s);return r}function I(t,e,r,s=1e-9,n=1e-9){if(t>n)return new Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<s&&t.set(e,0,0);return t.to1DArray()}}class C{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(!(t=N.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let s,n,i=t.columns,o=new b(i,i),a=new Float64Array(i),u=new Float64Array(i),c=t,h=!1;if(h=!!r||t.isSymmetric(),h){for(s=0;s<i;s++)for(n=0;n<i;n++)o.set(s,n,c.get(s,n));!function(t,e,r,s){let n,i,o,a,u,c,h,l;for(u=0;u<t;u++)r[u]=s.get(t-1,u);for(a=t-1;a>0;a--){for(l=0,o=0,c=0;c<a;c++)l+=Math.abs(r[c]);if(0===l)for(e[a]=r[a-1],u=0;u<a;u++)r[u]=s.get(a-1,u),s.set(a,u,0),s.set(u,a,0);else{for(c=0;c<a;c++)r[c]/=l,o+=r[c]*r[c];for(n=r[a-1],i=Math.sqrt(o),n>0&&(i=-i),e[a]=l*i,o-=n*i,r[a-1]=n-i,u=0;u<a;u++)e[u]=0;for(u=0;u<a;u++){for(n=r[u],s.set(u,a,n),i=e[u]+s.get(u,u)*n,c=u+1;c<=a-1;c++)i+=s.get(c,u)*r[c],e[c]+=s.get(c,u)*n;e[u]=i}for(n=0,u=0;u<a;u++)e[u]/=o,n+=e[u]*r[u];for(h=n/(o+o),u=0;u<a;u++)e[u]-=h*r[u];for(u=0;u<a;u++){for(n=r[u],i=e[u],c=u;c<=a-1;c++)s.set(c,u,s.get(c,u)-(n*e[c]+i*r[c]));r[u]=s.get(a-1,u),s.set(a,u,0)}}r[a]=o}for(a=0;a<t-1;a++){if(s.set(t-1,a,s.get(a,a)),s.set(a,a,1),o=r[a+1],0!==o){for(c=0;c<=a;c++)r[c]=s.get(c,a+1)/o;for(u=0;u<=a;u++){for(i=0,c=0;c<=a;c++)i+=s.get(c,a+1)*s.get(c,u);for(c=0;c<=a;c++)s.set(c,u,s.get(c,u)-i*r[c])}}for(c=0;c<=a;c++)s.set(c,a+1,0)}for(u=0;u<t;u++)r[u]=s.get(t-1,u),s.set(t-1,u,0);s.set(t-1,t-1,1),e[0]=0}(i,u,a,o),function(t,e,r,s){let n,i,o,a,u,c,h,l,f,g,m,p,w,d,y,b;for(o=1;o<t;o++)e[o-1]=e[o];e[t-1]=0;let x=0,M=0,v=Number.EPSILON;for(c=0;c<t;c++){for(M=Math.max(M,Math.abs(r[c])+Math.abs(e[c])),h=c;h<t&&!(Math.abs(e[h])<=v*M);)h++;if(h>c)do{for(n=r[c],l=(r[c+1]-n)/(2*e[c]),f=$(l,1),l<0&&(f=-f),r[c]=e[c]/(l+f),r[c+1]=e[c]*(l+f),g=r[c+1],i=n-r[c],o=c+2;o<t;o++)r[o]-=i;for(x+=i,l=r[h],m=1,p=m,w=m,d=e[c+1],y=0,b=0,o=h-1;o>=c;o--)for(w=p,p=m,b=y,n=m*e[o],i=m*l,f=$(l,e[o]),e[o+1]=y*f,y=e[o]/f,m=l/f,l=m*r[o]-y*n,r[o+1]=i+y*(m*n+y*r[o]),u=0;u<t;u++)i=s.get(u,o+1),s.set(u,o+1,y*s.get(u,o)+m*i),s.set(u,o,m*s.get(u,o)-y*i);l=-y*b*w*d*e[c]/g,e[c]=y*l,r[c]=m*l}while(Math.abs(e[c])>v*M);r[c]=r[c]+x,e[c]=0}for(o=0;o<t-1;o++){for(u=o,l=r[o],a=o+1;a<t;a++)r[a]<l&&(u=a,l=r[a]);if(u!==o)for(r[u]=r[o],r[o]=l,a=0;a<t;a++)l=s.get(a,o),s.set(a,o,s.get(a,u)),s.set(a,u,l)}}(i,u,a,o)}else{let t=new b(i,i),e=new Float64Array(i);for(n=0;n<i;n++)for(s=0;s<i;s++)t.set(s,n,c.get(s,n));!function(t,e,r,s){let n,i,o,a,u,c,h,l=0,f=t-1;for(c=l+1;c<=f-1;c++){for(h=0,a=c;a<=f;a++)h+=Math.abs(e.get(a,c-1));if(0!==h){for(o=0,a=f;a>=c;a--)r[a]=e.get(a,c-1)/h,o+=r[a]*r[a];for(i=Math.sqrt(o),r[c]>0&&(i=-i),o-=r[c]*i,r[c]=r[c]-i,u=c;u<t;u++){for(n=0,a=f;a>=c;a--)n+=r[a]*e.get(a,u);for(n/=o,a=c;a<=f;a++)e.set(a,u,e.get(a,u)-n*r[a])}for(a=0;a<=f;a++){for(n=0,u=f;u>=c;u--)n+=r[u]*e.get(a,u);for(n/=o,u=c;u<=f;u++)e.set(a,u,e.get(a,u)-n*r[u])}r[c]=h*r[c],e.set(c,c-1,h*i)}}for(a=0;a<t;a++)for(u=0;u<t;u++)s.set(a,u,a===u?1:0);for(c=f-1;c>=l+1;c--)if(0!==e.get(c,c-1)){for(a=c+1;a<=f;a++)r[a]=e.get(a,c-1);for(u=c;u<=f;u++){for(i=0,a=c;a<=f;a++)i+=r[a]*s.get(a,u);for(i=i/r[c]/e.get(c,c-1),a=c;a<=f;a++)s.set(a,u,s.get(a,u)+i*r[a])}}}(i,t,e,o),function(t,e,r,s,n){let i,o,a,u,c,h,l,f,g,m,p,w,d,y,b,x=t-1,M=0,v=t-1,E=Number.EPSILON,S=0,N=0,T=0,$=0,R=0,D=0,k=0,A=0;for(i=0;i<t;i++)for((i<M||i>v)&&(r[i]=n.get(i,i),e[i]=0),o=Math.max(i-1,0);o<t;o++)N+=Math.abs(n.get(i,o));for(;x>=M;){for(u=x;u>M&&(D=Math.abs(n.get(u-1,u-1))+Math.abs(n.get(u,u)),0===D&&(D=N),!(Math.abs(n.get(u,u-1))<E*D));)u--;if(u===x)n.set(x,x,n.get(x,x)+S),r[x]=n.get(x,x),e[x]=0,x--,A=0;else if(u===x-1){if(l=n.get(x,x-1)*n.get(x-1,x),T=(n.get(x-1,x-1)-n.get(x,x))/2,$=T*T+l,k=Math.sqrt(Math.abs($)),n.set(x,x,n.get(x,x)+S),n.set(x-1,x-1,n.get(x-1,x-1)+S),f=n.get(x,x),$>=0){for(k=T>=0?T+k:T-k,r[x-1]=f+k,r[x]=r[x-1],0!==k&&(r[x]=f-l/k),e[x-1]=0,e[x]=0,f=n.get(x,x-1),D=Math.abs(f)+Math.abs(k),T=f/D,$=k/D,R=Math.sqrt(T*T+$*$),T/=R,$/=R,o=x-1;o<t;o++)k=n.get(x-1,o),n.set(x-1,o,$*k+T*n.get(x,o)),n.set(x,o,$*n.get(x,o)-T*k);for(i=0;i<=x;i++)k=n.get(i,x-1),n.set(i,x-1,$*k+T*n.get(i,x)),n.set(i,x,$*n.get(i,x)-T*k);for(i=M;i<=v;i++)k=s.get(i,x-1),s.set(i,x-1,$*k+T*s.get(i,x)),s.set(i,x,$*s.get(i,x)-T*k)}else r[x-1]=f+T,r[x]=f+T,e[x-1]=k,e[x]=-k;x-=2,A=0}else{if(f=n.get(x,x),g=0,l=0,u<x&&(g=n.get(x-1,x-1),l=n.get(x,x-1)*n.get(x-1,x)),10===A){for(S+=f,i=M;i<=x;i++)n.set(i,i,n.get(i,i)-f);D=Math.abs(n.get(x,x-1))+Math.abs(n.get(x-1,x-2)),f=g=.75*D,l=-.4375*D*D}if(30===A&&(D=(g-f)/2,D=D*D+l,D>0)){for(D=Math.sqrt(D),g<f&&(D=-D),D=f-l/((g-f)/2+D),i=M;i<=x;i++)n.set(i,i,n.get(i,i)-D);S+=D,f=g=l=.964}for(A+=1,c=x-2;c>=u&&(k=n.get(c,c),R=f-k,D=g-k,T=(R*D-l)/n.get(c+1,c)+n.get(c,c+1),$=n.get(c+1,c+1)-k-R-D,R=n.get(c+2,c+1),D=Math.abs(T)+Math.abs($)+Math.abs(R),T/=D,$/=D,R/=D,c!==u)&&!(Math.abs(n.get(c,c-1))*(Math.abs($)+Math.abs(R))<E*(Math.abs(T)*(Math.abs(n.get(c-1,c-1))+Math.abs(k)+Math.abs(n.get(c+1,c+1)))));)c--;for(i=c+2;i<=x;i++)n.set(i,i-2,0),i>c+2&&n.set(i,i-3,0);for(a=c;a<=x-1&&(y=a!==x-1,a!==c&&(T=n.get(a,a-1),$=n.get(a+1,a-1),R=y?n.get(a+2,a-1):0,f=Math.abs(T)+Math.abs($)+Math.abs(R),0!==f&&(T/=f,$/=f,R/=f)),0!==f);a++)if(D=Math.sqrt(T*T+$*$+R*R),T<0&&(D=-D),0!==D){for(a!==c?n.set(a,a-1,-D*f):u!==c&&n.set(a,a-1,-n.get(a,a-1)),T+=D,f=T/D,g=$/D,k=R/D,$/=T,R/=T,o=a;o<t;o++)T=n.get(a,o)+$*n.get(a+1,o),y&&(T+=R*n.get(a+2,o),n.set(a+2,o,n.get(a+2,o)-T*k)),n.set(a,o,n.get(a,o)-T*f),n.set(a+1,o,n.get(a+1,o)-T*g);for(i=0;i<=Math.min(x,a+3);i++)T=f*n.get(i,a)+g*n.get(i,a+1),y&&(T+=k*n.get(i,a+2),n.set(i,a+2,n.get(i,a+2)-T*R)),n.set(i,a,n.get(i,a)-T),n.set(i,a+1,n.get(i,a+1)-T*$);for(i=M;i<=v;i++)T=f*s.get(i,a)+g*s.get(i,a+1),y&&(T+=k*s.get(i,a+2),s.set(i,a+2,s.get(i,a+2)-T*R)),s.set(i,a,s.get(i,a)-T),s.set(i,a+1,s.get(i,a+1)-T*$)}}}if(0===N)return;for(x=t-1;x>=0;x--)if(T=r[x],$=e[x],0===$)for(u=x,n.set(x,x,1),i=x-1;i>=0;i--){for(l=n.get(i,i)-T,R=0,o=u;o<=x;o++)R+=n.get(i,o)*n.get(o,x);if(e[i]<0)k=l,D=R;else if(u=i,0===e[i]?n.set(i,x,0!==l?-R/l:-R/(E*N)):(f=n.get(i,i+1),g=n.get(i+1,i),$=(r[i]-T)*(r[i]-T)+e[i]*e[i],h=(f*D-k*R)/$,n.set(i,x,h),n.set(i+1,x,Math.abs(f)>Math.abs(k)?(-R-l*h)/f:(-D-g*h)/k)),h=Math.abs(n.get(i,x)),E*h*h>1)for(o=i;o<=x;o++)n.set(o,x,n.get(o,x)/h)}else if($<0)for(u=x-1,Math.abs(n.get(x,x-1))>Math.abs(n.get(x-1,x))?(n.set(x-1,x-1,$/n.get(x,x-1)),n.set(x-1,x,-(n.get(x,x)-T)/n.get(x,x-1))):(b=F(0,-n.get(x-1,x),n.get(x-1,x-1)-T,$),n.set(x-1,x-1,b[0]),n.set(x-1,x,b[1])),n.set(x,x-1,0),n.set(x,x,1),i=x-2;i>=0;i--){for(m=0,p=0,o=u;o<=x;o++)m+=n.get(i,o)*n.get(o,x-1),p+=n.get(i,o)*n.get(o,x);if(l=n.get(i,i)-T,e[i]<0)k=l,R=m,D=p;else if(u=i,0===e[i]?(b=F(-m,-p,l,$),n.set(i,x-1,b[0]),n.set(i,x,b[1])):(f=n.get(i,i+1),g=n.get(i+1,i),w=(r[i]-T)*(r[i]-T)+e[i]*e[i]-$*$,d=2*(r[i]-T)*$,0===w&&0===d&&(w=E*N*(Math.abs(l)+Math.abs($)+Math.abs(f)+Math.abs(g)+Math.abs(k))),b=F(f*R-k*m+$*p,f*D-k*p-$*m,w,d),n.set(i,x-1,b[0]),n.set(i,x,b[1]),Math.abs(f)>Math.abs(k)+Math.abs($)?(n.set(i+1,x-1,(-m-l*n.get(i,x-1)+$*n.get(i,x))/f),n.set(i+1,x,(-p-l*n.get(i,x)-$*n.get(i,x-1))/f)):(b=F(-R-g*n.get(i,x-1),-D-g*n.get(i,x),k,$),n.set(i+1,x-1,b[0]),n.set(i+1,x,b[1]))),h=Math.max(Math.abs(n.get(i,x-1)),Math.abs(n.get(i,x))),E*h*h>1)for(o=i;o<=x;o++)n.set(o,x-1,n.get(o,x-1)/h),n.set(o,x,n.get(o,x)/h)}for(i=0;i<t;i++)if(i<M||i>v)for(o=i;o<t;o++)s.set(i,o,n.get(i,o));for(o=t-1;o>=M;o--)for(i=M;i<=v;i++){for(k=0,a=M;a<=Math.min(o,v);a++)k+=s.get(i,a)*n.get(a,o);s.set(i,o,k)}}(i,u,a,o,t)}this.n=i,this.e=u,this.d=a,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,s=this.e,n=this.d,i=new b(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)i.set(t,e,0);i.set(t,t,n[t]),s[t]>0?i.set(t,t+1,s[t]):s[t]<0&&i.set(t,t-1,s[t])}return i}}function F(t,e,r,s){let n,i;return Math.abs(r)>Math.abs(s)?(n=s/r,i=r+n*s,[(t+n*e)/i,(e-n*t)/i]):(n=r/s,i=s+n*r,[(n*t+e)/i,(n*e-t)/i])}class q{constructor(t){if(!(t=N.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,r,s,n=t,i=n.rows,o=new b(i,i),a=!0;for(r=0;r<i;r++){let t=0;for(s=0;s<r;s++){let i=0;for(e=0;e<s;e++)i+=o.get(s,e)*o.get(r,e);i=(n.get(r,s)-i)/o.get(s,s),o.set(r,s,i),t+=i*i}for(t=n.get(r,r)-t,a&&=t>0,o.set(r,r,Math.sqrt(Math.max(t,0))),s=r+1;s<i;s++)o.set(r,s,0)}this.L=o,this.positiveDefinite=a}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=N.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let s,n,i,o=t.columns,a=t.clone();for(i=0;i<r;i++)for(n=0;n<o;n++){for(s=0;s<i;s++)a.set(i,n,a.get(i,n)-a.get(s,n)*e.get(i,s));a.set(i,n,a.get(i,n)/e.get(i,i))}for(i=r-1;i>=0;i--)for(n=0;n<o;n++){for(s=i+1;s<r;s++)a.set(i,n,a.get(i,n)-a.get(s,n)*e.get(s,i));a.set(i,n,a.get(i,n)/e.get(i,i))}return a}get lowerTriangularMatrix(){return this.L}}class P{constructor(e,r={}){e=N.checkMatrix(e);let{Y:s}=r;const{scaleScores:n=!1,maxIterations:i=1e3,terminationCriteria:o=1e-10}=r;let a;if(s){if(s=t.isAnyArray(s)&&"number"==typeof s[0]?b.columnVector(s):N.checkMatrix(s),s.rows!==e.rows)throw new Error("Y should have the same number of rows as X");a=s.getColumnVector(0)}else a=e.getColumnVector(0);let u,c,h,l,f=1;for(let t=0;t<i&&f>o;t++)h=e.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),h=h.div(h.norm()),u=e.mmul(h).div(h.transpose().mmul(h).get(0,0)),t>0&&(f=u.clone().sub(l).pow(2).sum()),l=u.clone(),s?(c=s.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),c=c.div(c.norm()),a=s.mmul(c).div(c.transpose().mmul(c).get(0,0))):a=u;if(s){let t=e.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));t=t.div(t.norm());let r=e.clone().sub(u.clone().mmul(t.transpose())),n=a.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),i=s.clone().sub(u.clone().mulS(n.get(0,0)).mmul(c.transpose()));this.t=u,this.p=t.transpose(),this.w=h.transpose(),this.q=c,this.u=a,this.s=u.transpose().mmul(u),this.xResidual=r,this.yResidual=i,this.betas=n}else this.w=h.transpose(),this.s=u.transpose().mmul(u).sqrt(),this.t=n?u.clone().div(this.s.get(0,0)):u,this.xResidual=e.sub(u.mmul(h.transpose()))}}return Vt.AbstractMatrix=d,Vt.CHO=q,Vt.CholeskyDecomposition=q,Vt.DistanceMatrix=M,Vt.EVD=C,Vt.EigenvalueDecomposition=C,Vt.LU=T,Vt.LuDecomposition=T,Vt.Matrix=b,Vt.MatrixColumnSelectionView=class extends v{constructor(t,e){f(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},Vt.MatrixColumnView=class extends v{constructor(t,e){u(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}},Vt.MatrixFlipColumnView=class extends v{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},Vt.MatrixFlipRowView=class extends v{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},Vt.MatrixRowSelectionView=class extends v{constructor(t,e){l(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},Vt.MatrixRowView=class extends v{constructor(t,e){a(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}},Vt.MatrixSelectionView=E,Vt.MatrixSubView=class extends v{constructor(t,e,r,s,n){g(t,e,r,s,n),super(t,r-e+1,n-s+1),this.startRow=e,this.startColumn=s}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},Vt.MatrixTransposeView=class extends v{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}},Vt.NIPALS=P,Vt.Nipals=P,Vt.QR=R,Vt.QrDecomposition=R,Vt.SVD=D,Vt.SingularValueDecomposition=D,Vt.SymmetricMatrix=x,Vt.WrapperMatrix1D=S,Vt.WrapperMatrix2D=N,Vt.correlation=function(e,r=e,s={}){e=new b(e);let n=!1;if("object"!=typeof r||b.isMatrix(r)||t.isAnyArray(r)?r=new b(r):(s=r,r=e,n=!0),e.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0,scale:o=!0}=s;i&&(e.center("column"),n||r.center("column")),o&&(e.scale("column"),n||r.scale("column"));const a=e.standardDeviation("column",{unbiased:!0}),u=n?a:r.standardDeviation("column",{unbiased:!0}),c=e.transpose().mmul(r);for(let t=0;t<c.rows;t++)for(let r=0;r<c.columns;r++)c.set(t,r,c.get(t,r)*(1/(a[t]*u[r]))*(1/(e.rows-1)));return c},Vt.covariance=function(e,r=e,s={}){e=new b(e);let n=!1;if("object"!=typeof r||b.isMatrix(r)||t.isAnyArray(r)?r=new b(r):(s=r,r=e,n=!0),e.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0}=s;i&&(e=e.center("column"),n||(r=r.center("column")));const o=e.transpose().mmul(r);for(let t=0;t<o.rows;t++)for(let r=0;r<o.columns;r++)o.set(t,r,o.get(t,r)*(1/(e.rows-1)));return o},Vt.default=b,Vt.determinant=function t(e){if((e=b.checkMatrix(e)).isSquare()){if(0===e.columns)return 1;let r,s,n,i;if(2===e.columns)return r=e.get(0,0),s=e.get(0,1),n=e.get(1,0),i=e.get(1,1),r*i-s*n;if(3===e.columns){let i,o,a;return i=new E(e,[1,2],[1,2]),o=new E(e,[1,2],[0,2]),a=new E(e,[1,2],[0,1]),r=e.get(0,0),s=e.get(0,1),n=e.get(0,2),r*t(i)-s*t(o)+n*t(a)}return new T(e).determinant}throw Error("determinant can only be calculated for a square matrix")},Vt.inverse=function(t,e=!1){return t=N.checkMatrix(t),e?new D(t).inverse():k(t,b.eye(t.rows))},Vt.linearDependencies=function(t,e={}){const{thresholdValue:r=1e-9,thresholdError:s=1e-9}=e;let n=(t=b.checkMatrix(t)).rows,i=new b(n,n);for(let e=0;e<n;e++){let o=b.columnVector(t.getRow(e)),a=t.subMatrixRow(A(n,e)).transpose(),u=new D(a).solve(o),c=b.sub(o,a.mmul(u)).abs().max();i.setRow(e,I(c,u,e,r,s))}return i},Vt.pseudoInverse=function(t,e=Number.EPSILON){if((t=b.checkMatrix(t)).isEmpty())return t.transpose();let r=new D(t,{autoTranspose:!0}),s=r.leftSingularVectors,n=r.rightSingularVectors,i=r.diagonal;for(let t=0;t<i.length;t++)Math.abs(i[t])>e?i[t]=1/i[t]:i[t]=0;return n.mmul(b.diag(i).mmul(s.transpose()))},Vt.solve=k,Vt.wrap=function(e,r){if(t.isAnyArray(e))return e[0]&&t.isAnyArray(e[0])?new N(e):new S(e,r);throw new Error("the argument is not an array")},Vt}var Ut=Lt(),Zt=Pt(Ut);const Bt=Ut.Matrix;Zt.Matrix?Zt.Matrix:Ut.Matrix;class Wt{constructor(t,e,r){if(!Array.isArray(t))throw new Error("DMatrix: data 必须是数组");if(t.length!==e*r)throw new Error(`DMatrix: data 的长度 ${t.length} 不等于 rows * cols ${e} * ${r}`);this.data=t,this.rows=e,this.cols=r}apply(t,e){if(e instanceof Wt){if(this.rows!==e.rows||this.cols!==e.cols)throw new Error("行列不匹配");return new Wt(this.data.map(((r,s)=>t(r,e.data[s]))),this.rows,this.cols)}if("number"==typeof(r=e)||"bigint"==typeof r||r instanceof qt){let r=new Wt(this.data.map((r=>t(r,e))),this.rows,this.cols);return r}var r;throw new Error("不支持的矩阵运算")}map(t){return new Wt(this.data.map(t),this.rows,this.cols)}matmul(t){const e=this.toMatrix(),r=t.toMatrix();if(e.columns!==r.rows)throw new Error("矩阵乘法：m1 的列数与 m2 的行数不匹配");const s=e.mmul(r);return new Wt(s.to1DArray().map((t=>new qt(t))),s.rows,s.columns)}toMatrix(){let t=[];for(let e=0;e<this.rows;e++){let r=[];for(let t=0;t<this.cols;t++){let s=Number(this.data[e*this.cols+t]);r.push(s)}t.push(r)}return new Bt(t)}toString(){let t=this.data.map((t=>t.toFixed(6).replace(/\.?0+$/,"")));if(1===this.cols)return`[${t.join(",")}]`;let e=[];for(let r=0;r<this.rows;r++){let s=[];for(let e=0;e<this.cols;e++)s.push(t[r*this.cols+e]);e.push(s.join(","))}return`{${e.join(";")}}`}}qt.set({precision:21});class Qt{constructor(t,e,r){this.year=t,this.month=e,this.timestamp=r}getYMString(){let t="";return 0!==this.year&&(t+=this.year+"年"),0!==this.month&&(t+=this.month+"月"),""!=t&&(t+="+"),t}toString(){return this.getYMString()+this.timestamp+"ms"}}const Kt={pi:qt.acos(-1),e:qt.exp(1)};function Jt(t){return t instanceof qt}function Xt(t){return function(t){return"number"==typeof t}(t)||function(t){return"bigint"==typeof t}(t)||Jt(t)}function Gt(t){return t instanceof Date&&!isNaN(t)}function te(t){return t instanceof Qt}function ee(t){return t instanceof Wt}function re(t,e,r,s,n){if(Jt(e)&&Jt(r))return s(e,r);if(o=r,ee(i=e)&&ee(o)||ee(i)&&Xt(o)||Xt(i)&&ee(o))return ee(e)?e.apply(s,r):r.apply(n,e);var i,o;if(typeof e!=typeof r)throw new Error(`${t} 参数类型不一致: ${typeof e} 和 ${typeof r}`);throw new Error(`不支持的运算: ${t}`)}const se={convertTypes(t,e="decimal"){if("decimal"===e)return ee(t)?t:new qt(t.toString());if("number"===e)return Number(t.toString());if("bigint"===e)return BigInt(t.toString());if("string"===e)return t.toString();if("any"===e)return t;throw new Error(`无法将 ${t} 转换为 ${e} 类型`)},formatToDisplayString(t){if(te(t))return{value:t.toString(),info:"时间间隔："+se.formatDateStamp(t)};if(Gt(t))return{value:t.getTime(),info:"时间戳对应日期："+se.formatDate(t)};if(Jt(t)){if(t.toString().includes("e+")||t.toString().includes("e-")){let e=t.toExponential(16),[r,s]=e.split("e");return r=r.replace(/\.?0+$/,""),r+"e"+s}return t.isInteger()?t.toString():t.toFixed(16).replace(/\.?0+$/,"")}return ee(t)?{value:t.toString(),info:"isMatrix"}:t.toString()},add(t,e){if("string"==typeof t||"string"==typeof e)return t.toString()+e.toString();if(te(t)&&te(e))return new Qt(t.year+e.year,t.month+e.month,t.timestamp+e.timestamp);if(Gt(t)&&te(e)){const r=new Date(t);return r.setFullYear(r.getFullYear()+e.year),r.setMonth(r.getMonth()+e.month),r.setMilliseconds(r.getMilliseconds()+e.timestamp),r}if(Gt(e)&&te(t)){const r=new Date(e);return r.setFullYear(r.getFullYear()+t.year),r.setMonth(r.getMonth()+t.month),r.setMilliseconds(r.getMilliseconds()+t.timestamp),r}if(Gt(t)&&Gt(e))throw new Error("两个日期类型不能相加");let r=(t,e)=>qt(t).plus(qt(e));return re("加法",t,e,r,r)},subtract(t,e){if(te(t)){if(te(e))return new Qt(t.year-e.year,t.month-e.month,t.timestamp-e.timestamp);throw Gt(e)?new Error("时间戳不能减去日期 "):new Error("不支持的时间戳减法")}if(Gt(t)){if(te(e)){const r=new Date(t);return r.setFullYear(r.getFullYear()-e.year),r.setMonth(r.getMonth()-e.month),r.setMilliseconds(r.getMilliseconds()-e.timestamp),r}if(Gt(e)){const r=t.getTime()-e.getTime();return new Qt(0,0,r)}throw new Error("不支持的日期减法")}return re("减法",t,e,((t,e)=>qt(t).minus(qt(e))),((t,e)=>qt(e).minus(qt(t))))},multiply(t,e){let r=(t,e)=>t.times(e);return re("乘法",t,e,r,r)},divide:(t,e)=>re("除法",t,e,((t,e)=>t.div(e)),((t,e)=>e.div(t))),floorDivide:(t,e)=>re("整除",t,e,((t,e)=>t.div(e).floor()),((t,e)=>e.div(t).floor())),mod:(t,e)=>re("取模",t,e,((t,e)=>t.mod(e)),((t,e)=>e.mod(t))),pow:(t,e)=>re("幂运算",t,e,((t,e)=>t.pow(e)),((t,e)=>e.pow(t))),toFixed(t,e){const r=Jt(t)?t:new qt(t);return r.isInteger()?r.toString():r.toFixed(e).replace(/\.?0+$/,"")},random(...t){if(0===t.length)return qt.random().toFixed(8);if(1===t.length){const e=t[0].toNumber(),r=Array.from({length:e},(()=>qt.random()));return new Wt(r,e,1)}if(2===t.length){const e=t[0].toNumber(),r=t[1].toNumber(),s=Array.from({length:e*r},(()=>qt.random()));return new Wt(s,e,r)}throw new Error(`random函数参数数量(${t.length})错误，应为0, 1, 2`)},radianToPi(t){const e=(Jt(t)?t:new qt(t)).div(Kt.pi);if(e.isInteger())return e.equals(1)?"π":e.equals(-1)?"-π":`${e}*π`;const r=[2,3,4,6,8,12];for(const t of r){const r=e.toNumber()*t;if(Math.abs(Math.round(r)-r)<1e-8){const e=Math.round(r);return 1===Math.abs(e)?e>0?`π/${t}`:`-π/${t}`:`${e}*π/${t}`}}return`${e.toFixed(6)}*π`},radianToDeg(t){let e=(Jt(t)?t:new qt(t)).times(180).div(Kt.pi);return e=e.mod(360),e.lt(0)&&(e=e.plus(360)),e},dateToTimestamp(t){const e=new Date(t);if(isNaN(e.getTime()))throw new Error(`无法将${t}转成日期`);return e.getTime()},formatDate(t){if(te(t))throw new Error('无法将时间间隔转成日期, 请使用"> #"');const e=new Date(t);if(isNaN(e.getTime()))throw new Error(`无法将${t}转成日期`);const r=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes(),a=e.getSeconds();return 0===i&&0===o&&0===a?`${r}-${s.toString().padStart(2,"0")}-${n.toString().padStart(2,"0")}`:`${r}-${s.toString().padStart(2,"0")}-${n.toString().padStart(2,"0")} ${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},formatDateStamp(t){if(!te(t))throw new Error('"> #"只能可视化时间间隔类型');const e=t.timestamp,r=Math.abs(e),s=Math.floor(r/1e3%60),n=Math.floor(r/6e4%60),i=Math.floor(r/36e5%24),o=`${e<0?"-":""}${Math.floor(r/864e5)}天 ${i}小时 ${n}分钟 ${s}秒`;return t.getYMString()+o},formatDateStamp2Week(t){if(!te(t))throw new Error('"> #w"只能可视化时间间隔类型');const e=(t.timestamp/6048e5).toFixed(2)+"周";return t.getYMString()+e},formatDateStamp2Day(t){if(!te(t))throw new Error('"> #d"只能可视化时间间隔类型');const e=(t.timestamp/864e5).toFixed(2)+"天";return t.getYMString()+e},formatDateStamp2Hour(t){if(!te(t))throw new Error('"> #h"只能可视化时间间隔类型');const e=(t.timestamp/36e5).toFixed(2)+"小时";return t.getYMString()+e},formatDateStamp2Minute(t){if(!te(t))throw new Error('"> #m"只能可视化时间间隔类型');const e=(t.timestamp/6e4).toFixed(2)+"分钟";return t.getYMString()+e},formatDateStamp2Second(t){if(!te(t))throw new Error('"> #s"只能可视化时间间隔类型');const e=(t.timestamp/1e3).toFixed(2)+"秒";return t.getYMString()+e},str2vec(t){if("["!==(t=t.trim())[0]||"]"!==t[t.length-1])throw new Error("vector格式错误，请使用方括号[]");let e=(t=(t=t.replace(/\s*\[\s*/g,"")).replace(/\s*\]\s*/g,"")).split(/\s+/).map((t=>qt(t.trim())));if(0===e.length)throw new Error("vector 长度为0");for(let t=0;t<e.length;t++)if(isNaN(e[t]))throw new Error(`vector${t+1}: ${e[t]} 不是数字`);return new Wt(e,e.length,1)},str2Matrix(t){if("{"!==(t=t.trim())[0]||"}"!==t[t.length-1])throw new Error("matrix格式错误，请使用大括号{}");let e=(t=(t=(t=t.replace(/\s*\{\s*/g,"")).replace(/\s*\}\s*/g,"")).replace(/\s*;\s*/g,";")).split(";").map((t=>t.trim().split(/\s+/).map(qt)));if(0===e.length)throw new Error("matrix 长度为0");let r=e[0].length;for(let t=0;t<e.length;t++)if(e[t].length!==r)throw new Error("matrix 每行长度不一致");let s=e.flat();return new Wt(s,e.length,r)},matmul(t,e){if(ee(t)&&ee(e))return t.matmul(e);throw new Error("矩阵乘法参数错误")}},ne={"π":Kt.pi,PI:Kt.pi,pi:Kt.pi,e:Kt.e,E:Kt.e},ie={"(":{description:"左括号"},")":{description:"右括号"}},oe={",":{description:"参数分隔符"}},ae={"+":{precedence:2,args:2,func:se.add,argTypes:"any",position:"infix",description:"加法"},"-":{precedence:2,args:2,func:se.subtract,argTypes:"any",position:"infix",description:"减法"},"*":{precedence:4,args:2,func:se.multiply,position:"infix",description:"乘法"},"/":{precedence:4,args:2,func:se.divide,position:"infix",description:"除法"},"//":{precedence:4,args:2,func:se.floorDivide,position:"infix",description:"整除"},"%":{precedence:4,args:2,func:se.mod,position:"infix",description:"取模"},"**":{precedence:7,args:2,func:se.pow,position:"infix",description:"幂运算"},"°":{alias:".rad",description:"角度转弧度"},"unary-":{precedence:5,args:1,func:t=>t.neg(),position:"prefix",description:"负号"},"unary+":{precedence:5,args:1,func:t=>t,position:"prefix",description:"正号"},"unary%":{precedence:5,args:1,func:t=>t.times(.01),position:"postfix",preventSelfReference:!0,description:"百分号"},"‰":{precedence:5,args:1,func:t=>t.times(.001),position:"postfix",preventSelfReference:!0,description:"千分号"},"&":{precedence:1,args:2,func:(t,e)=>(console.log(typeof t,typeof e),t&e),position:"infix",argTypes:"bigint",description:"按位与"},and:{alias:"&",description:"按位与"},"|":{precedence:1,args:2,func:(t,e)=>t|e,position:"infix",argTypes:"bigint",description:"按位或"},or:{alias:"|",description:"按位或"},"^":{precedence:1,args:2,func:(t,e)=>t^e,position:"infix",argTypes:"bigint",description:"按位异或"},"~":{precedence:6,args:1,func:t=>~t,position:"prefix",argTypes:"bigint",description:"按位取反"},not:{alias:"~",description:"按位取反"},"<<":{precedence:3,args:2,func:(t,e)=>t<<e,position:"infix",argTypes:"bigint",description:"左移"},">>":{precedence:3,args:2,func:(t,e)=>t>>e,position:"infix",argTypes:"bigint",description:"右移"},">>>":{precedence:3,args:2,func:(t,e)=>t>>>e,position:"infix",argTypes:"number",description:"无符号右移"},"=":{precedence:0,args:2,func:(t,e)=>e,position:"infix",argTypes:"any",isCompoundAssignment:!0,description:"赋值"},"+=":{precedence:0,args:2,func:(t,e)=>t.add(e),position:"infix",description:"加法赋值",isCompoundAssignment:!0},"-=":{precedence:0,args:2,func:(t,e)=>t.sub(e),position:"infix",description:"减法赋值",isCompoundAssignment:!0},"*=":{precedence:0,args:2,func:(t,e)=>t.mul(e),position:"infix",description:"乘法赋值",isCompoundAssignment:!0},"/=":{precedence:0,args:2,func:(t,e)=>t.div(e),position:"infix",description:"除法赋值",isCompoundAssignment:!0},"&=":{precedence:0,args:2,func:(t,e)=>t&e,position:"infix",argTypes:"bigint",description:"按位与赋值",isCompoundAssignment:!0},"|=":{precedence:0,args:2,func:(t,e)=>(console.log("|=",t,e),console.log("oldValue的类型:",typeof t),console.log("rightValue的类型:",typeof e),t|e),position:"infix",argTypes:"bigint",description:"按位或赋值",isCompoundAssignment:!0},"^=":{precedence:0,args:2,func:(t,e)=>t^e,position:"infix",argTypes:"bigint",description:"按位异或赋值",isCompoundAssignment:!0},"<<=":{precedence:0,args:2,func:(t,e)=>t<<e,position:"infix",argTypes:"bigint",description:"左移赋值",isCompoundAssignment:!0},">>=":{precedence:0,args:2,func:(t,e)=>t>>e,position:"infix",argTypes:"bigint",description:"右移赋值",isCompoundAssignment:!0},">>>=":{precedence:0,args:2,func:(t,e)=>t>>>e,position:"infix",argTypes:"number",description:"无符号右移赋值",isCompoundAssignment:!0},"matmul@":{precedence:4,args:2,func:se.matmul,position:"infix",description:"矩阵乘法"},"@":{precedence:1,args:1,func:se.dateToTimestamp,position:"prefix",argTypes:"any",description:"日期转时间戳"},">@":{precedence:0,args:1,func:se.formatDate,position:"postfix",argTypes:"any",description:"时间戳可视化成日期"},">#":{precedence:0,args:1,func:se.formatDateStamp,position:"postfix",argTypes:"any",description:"时间差可视化"},">#w":{precedence:0,args:1,func:se.formatDateStamp2Week,position:"postfix",argTypes:"any",description:"时间差转成周数"},">#W":{alias:">#w",description:"时间差转成周数"},">#d":{precedence:0,args:1,func:se.formatDateStamp2Day,position:"postfix",argTypes:"any",description:"时间差转成天数"},">#D":{alias:">#d",description:"时间差转成天数"},">#h":{precedence:0,args:1,func:se.formatDateStamp2Hour,position:"postfix",argTypes:"any",description:"时间差转成小时数"},">#H":{alias:">#h",description:"时间差转成小时数"},">#m":{precedence:0,args:1,func:se.formatDateStamp2Minute,position:"postfix",argTypes:"any",description:"时间差转成分钟数"},">#M":{alias:">#m",description:"时间差转成分钟数"},">#s":{precedence:0,args:1,func:se.formatDateStamp2Second,position:"postfix",argTypes:"any",description:"时间差转成秒数"},">#S":{alias:">#s",description:"时间差转成秒数"}},ue={str:{func:t=>t.toString(),args:1,argTypes:"any",description:"转换为字符串"},num:{func:t=>t,args:1,description:"转换为数字"},max:{func:(...t)=>qt.max(...t),args:-1,description:"求最大值"},min:{func:(...t)=>qt.min(...t),args:-1,description:"求最小值"},lg:{func:t=>qt.log10(t),args:1,description:"以10为底的对数"},lb:{func:t=>qt.log2(t),args:1,description:"以2为底的对数"},log:{func:(t,e)=>qt.log(e,t),args:2,description:"以x为底的y对数"},ln:{func:t=>qt.ln(t),args:1,description:"自然对数"},exp:{func:t=>qt.exp(t),args:1,description:"e的指数"},round:{func:t=>qt.round(t),args:1,description:"四舍五入取整"},roundfix:{func:(t,e)=>((e=e.toNumber())<0&&(e=t.decimalPlaces()+e),e=Math.max(0,e),t.toDecimalPlaces(e)),args:2,description:"指定小数位数, 四舍五入取整"},floor:{func:t=>qt.floor(t),args:1,description:"向下取整"},ceil:{func:t=>qt.ceil(t),args:1,description:"向上取整"},clamp:{func:(t,e,r)=>qt.clamp(t,e,r),args:3,description:"设置数值范围"},random:{func:(...t)=>se.random(...t),args:-2,description:"随机数生成0~1"},sin:{func:t=>qt.sin(t),args:1,description:"正弦函数"},cos:{func:t=>qt.cos(t),args:1,description:"余弦函数"},tan:{func:t=>qt.tan(t),args:1,description:"正切函数"},asin:{func:t=>qt.asin(t),args:1,repr:t=>"弧度: "+se.radianToPi(t)+" | 角度: "+se.toFixed(se.radianToDeg(t),3)+"°",description:"反正弦函数"},acos:{func:t=>qt.acos(t),args:1,repr:t=>"弧度: "+se.radianToPi(t)+" | 角度: "+se.toFixed(se.radianToDeg(t),3)+"°",description:"反余弦函数"},atan:{func:t=>qt.atan(t),args:1,repr:t=>"弧度: "+se.radianToPi(t)+" | 角度: "+se.toFixed(se.radianToDeg(t),3)+"°",description:"反正切函数"},sinh:{func:t=>qt.sinh(t),args:1,description:"双曲正弦"},cosh:{func:t=>qt.cosh(t),args:1,description:"双曲余弦"},tanh:{func:t=>qt.tanh(t),args:1,description:"双曲正切"},sqrt:{func:t=>t.sqrt(),args:1,description:"平方根"},pow:{func:se.pow,args:2,description:"幂函数"},abs:{args:1,func:t=>t.abs(),asProperty:!0,description:"绝对值"},rad:{args:1,func:t=>t.times(Kt.pi).div(180),asProperty:!0,preventSelfReference:!0,repr:t=>"弧度: "+se.radianToPi(t)+" | 角度: "+se.toFixed(se.radianToDeg(t),3)+"°",description:"度数转换为弧度"},deg:{args:1,func:se.radianToDeg,asProperty:!0,preventSelfReference:!0,repr:t=>"角度: "+se.toFixed(t,3)+"°",description:"弧度转换为度数"},upper:{args:1,func:t=>t.toUpperCase(),argTypes:"any",asProperty:!0,description:"转换为大写"},lower:{args:1,func:t=>t.toLowerCase(),argTypes:"any",asProperty:!0,description:"转换为小写"},length:{args:1,func:t=>t.length,argTypes:"any",asProperty:!0,description:"字符串长度"},bin:{args:1,func:t=>"0b"+t.toString(2),asProperty:!0,argTypes:"bigint",description:"十进制转二进制"},oct:{args:1,func:t=>"0o"+t.toString(8),asProperty:!0,argTypes:"bigint",description:"十进制转八进制"},hex:{args:1,func:t=>"0x"+t.toString(16),asProperty:!0,argTypes:"bigint",description:"十进制转十六进制"},base64:{args:1,func:t=>{try{return"string"!=typeof t&&(t=String(t)),btoa(t)}catch(t){throw new Error("Base64编码失败: "+t.message)}},description:"Base64编码",argTypes:"any",asProperty:!0},unbase64:{args:1,func:t=>{try{return"string"!=typeof t&&(t=String(t)),atob(t)}catch(t){throw new Error("Base64解码失败: "+t.message)}},description:"Base64解码",argTypes:"any",asProperty:!0},timestamp:{args:8,func:(t=0,e=0,r=0,s=0,n=0,i=0,o=0,a=0)=>{const u=Number(t),c=Number(e);if(!Number.isInteger(u)||!Number.isInteger(c))throw new Error(`年:${u} 月:${c} 必须是整数`);return new Qt(u,c,1e3*(60*(60*(24*(7*r+s)+n)+i)+o)+a)},argTypes:"number",description:"时间间隔转换为时间戳"}},ce=new Map;function he(t,e){const r=new Date;let s;switch(e){case"now":s=r;break;case"today":s=new Date(r.getFullYear(),r.getMonth(),r.getDate());break;case"YYYY-MM-DD HH:mm:ss":s=new Date(t);break;case"YYYY-MM-DD HH:mm":s=new Date(t+":00");break;case"YYYY-MM-DD":s=new Date(t+"T00:00:00");break;case"MM-DD HH:mm:ss":t=t.replace(/^(\d{1,2})-(\d{1,2})/,((t,e,r)=>`${e.padStart(2,"0")}-${r.padStart(2,"0")}`)),s=new Date(r.getFullYear()+"-"+t);break;case"MM-DD HH:mm":t=t.replace(/^(\d{1,2})-(\d{1,2})/,((t,e,r)=>`${e.padStart(2,"0")}-${r.padStart(2,"0")}`)),s=new Date(r.getFullYear()+"-"+t+":00");break;case"YYYY-MM":s=new Date(t+"-01T00:00:00");break;case"MM-DD":t=t.replace(/(\d{1,2})-(\d{1,2})/,((t,e,r)=>`${e.padStart(2,"0")}-${r.padStart(2,"0")}`)),s=new Date(r.getFullYear()+"-"+t+"T00:00:00");break;case"YYYY":s=new Date(t+"-01-01T00:00:00");break;case"HH:mm:ss":{const[e,r,n]=t.split(":").map(Number);return s=new Date(0),s.setUTCHours(e,r,n),new Qt(0,0,s.getTime())}case"HH:mm":{const[e,r]=t.split(":").map(Number);return s=new Date(0),s.setUTCHours(e,r,0),new Qt(0,0,s.getTime())}default:return null}return isNaN(s.getTime())?null:s}const le=function(){const t=100,e=new Map,r=[],s=[];function n(t){r.includes(t)||r.push(t)}function i(t){s.includes(t)||s.push(t)}function o(){r.length=0,s.length=0}function a(r,s,i,o){const a=function(t){const e={"（":"(","）":")","，":",","”":'"',"；":";","’":"'","【":"[","】":"]","「":"{","」":"}","《":"<","》":">","＋":"+","－":"-","＝":"=","÷":"/","。":".","［":"[","］":"]","｛":"{","｝":"}","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","０":"0"},r=new RegExp(Object.keys(e).join("|"),"g");return t.replace(r,(t=>e[t]||t))}(r);a!==r&&n(`格式化: "${a}"`),r=a,ce.clear(),r=function(t){let e=0;return t=(t=t.replace(/\[([\d\s]+)\]/g,((t,r)=>{const s="_cc_mat_i"+e++,n=se.str2vec(t);return ce.set(s,n),s}))).replace(/\{([^{}]+)\}/g,((t,r)=>{const s="_cc_mat_i"+e++,n=se.str2Matrix(t);return ce.set(s,n),s})),t}(r=function(t){let e=0,r=t.replace(/str\s*\(((?:[^)(]|\([^)(]*\))*)\)/g,((t,r)=>{const s="_cc_str_i"+e++;return ce.set(s,r.trim()),s}));if(r=r.replace(/(['"`])((?:\\.|[^\\])*?)\1/g,((t,r,s)=>{const n="_cc_str_i"+e++,i=s.replace(/\\(['"\\`])/g,"$1");return ce.set(n,i),n})),/['"`][^'"`]*$/.test(r))throw new Error("未闭合的字符串字面量");return r}(r=function(t){function e(t){const e=["years?","y","months?","m","weeks?","w","days?","d","hours?","h","minutes?","mm","seconds?","s","milliseconds?","ms"].join("|"),r=new RegExp(`([+-]?\\d+\\.?\\d*)(${e})`,"gi");return t.replace(r,"($1)$2")}function r(t){if(""===t.trim())return t;const e={years:["y","year","years"],months:["m","month","months"],weeks:["w","week","weeks"],days:["d","day","days"],hours:["h","hour","hours"],minutes:["mm","minute","minutes"],seconds:["s","second","seconds"],milliseconds:["ms","millisecond","milliseconds"]},r="START",s="EXPECT_OPEN",n="IN_BRACKETS",i="EXPECT_UNIT",o="END";let a=r,u=0,c="",h=0,l={years:"0",months:"0",weeks:"0",days:"0",hours:"0",minutes:"0",seconds:"0",milliseconds:"0"},f=Object.keys(e),g=0;const m={y:["years","year","y"],m:["milliseconds","millisecond","minutes","months","minute","month","mins","min","mm","ms","m"],w:["weeks","week","w"],d:["days","day","d"],h:["hours","hour","h"],s:["seconds","second","s"]};for(;u<t.length&&a!==o;){const p=t[u];switch(a){case r:if("("===p)a=n,h=1,c="";else if(p.trim())throw m[p]?new Error(`时间单位:${t.slice(u,u+5)+"..."} 没有值`):new Error("时间值必须在括号内");break;case s:"("===p?(a=n,h=1,c=""):p.trim()&&"+"!==p&&"-"!==p&&(0===g&&(g=u),a=o);break;case n:if("("===p)h++,c+=p;else if(")"===p)if(h--,0===h){if(!c.trim())throw new Error("括号内不能为空");a=i}else c+=p;else c+=p;break;case i:let w=u,d={length:0,unitKey:"",value:c,endPos:u};const y=t[u].toLowerCase();if(m[y]){const r=m[y];for(const s of r)if(t.slice(u,u+s.length).toLowerCase()===s){let t;for(const[r,n]of Object.entries(e))if(n.includes(s)){if("0"!==l[r])throw new Error(`时间单位:${r} 重复赋值`);t=r;break}if(t){d={length:s.length,unitKey:t,value:c,endPos:u+s.length-1},u+=s.length-1;break}}}d.length>0?(l[d.unitKey]=d.value,u=d.endPos,g=u+1,f.indexOf(d.unitKey),a=s):(u=w,a=s)}u++}let p=`timestamp(${[l.years||"0",l.months||"0",l.weeks||"0",l.days||"0",l.hours||"0",l.minutes||"0",l.seconds||"0",l.milliseconds||"0"].join(", ")})`;if(g<t.length){const e=t.substring(g).trim();e&&(p+=" "+e)}return p}const s=(t=t.replace(/>\s*#/g,">timestamp")).split("#");let n=s[0];for(let t=1;t<s.length;t++)n+=r(e(s[t]));return n=n.replace(/>timestamp/g,">#"),n}(r=function(t){let e=0;const r=[{regex:/(@)\s*(\d{4})-(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2}):(\d{1,2})/,format:"YYYY-MM-DD HH:mm:ss",extract:t=>`${t[2]}-${t[3].padStart(2,"0")}-${t[4].padStart(2,"0")} ${t[5]}:${t[6]}:${t[7]}`},{regex:/(@)\s*(\d{4})-(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2})/,format:"YYYY-MM-DD HH:mm",extract:t=>`${t[2]}-${t[3].padStart(2,"0")}-${t[4].padStart(2,"0")} ${t[5]}:${t[6]}`},{regex:/(@)\s*(\d{4})-(\d{1,2})-(\d{1,2})/,format:"YYYY-MM-DD",extract:t=>`${t[2]}-${t[3].padStart(2,"0")}-${t[4].padStart(2,"0")}`},{regex:/(@)\s*(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2}):(\d{1,2})/,format:"MM-DD HH:mm:ss",extract:t=>`${t[2].padStart(2,"0")}-${t[3].padStart(2,"0")} ${t[4]}:${t[5]}:${t[6]}`},{regex:/(@)\s*(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2})/,format:"MM-DD HH:mm",extract:t=>`${t[2].padStart(2,"0")}-${t[3].padStart(2,"0")} ${t[4]}:${t[5]}`},{regex:/(@)\s*(\d{4})-(\d{1,2})/,format:"YYYY-MM",extract:t=>`${t[2]}-${t[3].padStart(2,"0")}`},{regex:/(#)\s*(\d{1,2}):(\d{1,2}):(\d{1,2})/,format:"HH:mm:ss",extract:t=>`${t[2].padStart(2,"0")}:${t[3].padStart(2,"0")}:${t[4].padStart(2,"0")}`},{regex:/(#)\s*(\d{1,2}):(\d{1,2})/,format:"HH:mm",extract:t=>`${t[2].padStart(2,"0")}:${t[3].padStart(2,"0")}`},{regex:/(@)\s*(\d{1,2})-(\d{1,2})/,format:"MM-DD",extract:t=>`${t[2].padStart(2,"0")}-${t[3].padStart(2,"0")}`},{regex:/(@)\s*(\d{4})/,format:"YYYY",extract:t=>t[2]},{regex:/(@)\s*(now)/,format:"now",extract:t=>t[2]},{regex:/(@)\s*(today)/,format:"today",extract:t=>t[2]}];let s;do{s=t;for(const{regex:s,format:n,extract:i}of r){const r=s.exec(t);if(r){const s=he(i(r),n);if(s){const n="_cc_date_i"+e++;ce.set(n,s),t=t.substring(0,r.index)+n+t.substring(r.index+r[0].length);break}}}}while(t!==s);return t}(r)))),r=r.replace(/\s/g,"");for(const[t,r]of ce)e.set(t,r);!function(t,e=1e3){const r=t.replace(/'[^']*'|"[^"]*"/g,""),s=[];let n=0;for(let t=0;t<r.length;t++)if("("===r[t]){if(s.push(t),n=Math.max(n,s.length),n>e)throw new Error("括号嵌套深度过大")}else if(")"===r[t]){if(0===s.length)throw new Error(`多余的右括号，位置: ${t}`);const e=s.pop();if(t-e>1e3)throw new Error(`括号内容过长，开始位置: ${e}`)}if(s.length>0){const t=s.join(", ");throw new Error(`缺少右括号，对应左括号位置: ${t}`)}const i=[{pattern:/\)[\w\d]/,message:"右括号后直接跟标识符"},{pattern:/\)\(/,message:"右括号后直接跟左括号"},{pattern:/,\s*\)/,message:"逗号后直接跟右括号"},{pattern:/\(\s*,/,message:"左括号后直接跟逗号"}];for(const{pattern:t,message:e}of i)if(t.test(r))throw new Error(`括号使用错误: ${e}`)}(r,t);for(const[t,e]of Object.entries(ue))e.asProperty&&(s.add("."+t),ae["."+t]={precedence:8,args:1,func:e.func,position:"postfix",...e.argTypes&&{argTypes:e.argTypes},...e.repr&&{repr:e.repr},...e.preventSelfReference&&{preventSelfReference:e.preventSelfReference}});return{expr:r,operators:new Set([...s].sort(((t,e)=>e.length-t.length)))}}function u(t,r,s,i){function o(){if(0===u.length)return!0;const[t,e]=u[u.length-1];return"%"!==e&&"‰"!==e&&!("string"===t||"constant"===t||"delimiter"===t&&")"===e||"function"===t||"identifier"===t||"operator"===t&&e.startsWith("."))}function a(){let e="";for(;c<t.length;){const r=t[c],n=e+r;if("0"===e&&("x"===r||"b"===r||"o"===r)){e+=r,c++;continue}if(/^\d+\.?\d*$/.test(e)&&("e"===r||"E"===r)){for(e+=r,c++,c<t.length&&("+"===t[c]||"-"===t[c])&&(e+=t[c],c++);c<t.length&&/\d/.test(t[c]);)e+=t[c],c++;continue}if(h.has(r)||l.has(r))break;const o=f.some((e=>t.startsWith(e,c))),a=[...s,...i].some((t=>t.startsWith(n)));if(o&&!a)break;e+=r,c++}return e}const u=[];let c=0;const h=new Set(Object.keys(ie)),l=new Set(Object.keys(oe)),f=[...r].sort(((t,e)=>e.length-t.length));for(;c<t.length;){const e=t[c],r=t.slice(c);let n=!1;for(const t of f)if(r.startsWith(t)){("="===t||ae[t].isCompoundAssignment)&&u.length>0&&"string"===u[u.length-1][0]&&(u[u.length-1][0]="identifier"),"+"===t?o()?u.push(["operator","unary+"]):u.push(["operator","+"]):"-"===t?o()?u.push(["operator","unary-"]):u.push(["operator","-"]):l.has(t)?u.push(["separator",t]):h.has(t)?u.push(["delimiter",t]):ae[t]&&ae[t].alias?u.push(["operator",ae[t].alias]):u.push(["operator",t]),c+=t.length,n=!0;break}if(!n)if(l.has(e))u.push(["separator",e]),c++;else if(h.has(e))u.push(["delimiter",e]),c++;else{const t=a();t&&(s.has(t)?ue[t]&&ue[t].alias?u.push(["function",ue[t].alias]):u.push(["function",t]):i.has(t)?u.push(["constant",t]):u.push(["string",t]))}}const g=function(t){if(!t.some((t=>("identifier"===t[0]||"string"===t[0])&&"x"===t[1]))&&!e.has("x"))for(let r=0;r<t.length;r++)if("string"===t[r][0]){if(t[r][1].startsWith("0x"))continue;if(e.has(t[r][1]))continue;const s=t[r][1].split("x");if(s.length>1){const e=[];for(let t=0;t<s.length;t++)s[t]&&(i.has(s[t])?e.push(["constant",s[t]]):e.push(["string",s[t]])),t<s.length-1&&(e.push(["operator","*"]),n("使用x作为乘法符号"));t.splice(r,1,...e),r+=e.length-1}}return t}(u);return g}function c(e,r,s){let n=0,i=0;const o=e.filter((t=>{const[e]=t;return"delimiter"!==e&&"separator"!==e})).length;let a=0;function u(){if(i>t)throw new Error("表达式嵌套深度过大，可能存在无限递归")}function c(t,e,r){return a++,{value:t,args:e,type:r}}function h(){if(n>=e.length)throw new Error("意外的表达式结束");const[t,r]=e[n];switch(n++,t){case"function":return function(t){l("(");const r=[];for(;n<e.length&&("delimiter"!==e[n][0]||")"!==e[n][1]);)r.push(f(0)),"separator"===e[n][0]&&n++;return l(")"),c(t,r,"function")}(r);case"constant":case"identifier":case"string":return c(r,[],t);case"delimiter":if("("===r){const t=f(0);return l(")"),t}throw new Error(`意外的定界符: ${r}`);default:throw new Error(`意外的token类型: ${t}`)}}function l(t){if(n>=e.length||"delimiter"!==e[n][0]||e[n][1]!==t)throw new Error(`期望定界符 "${t}"`);n++}function f(t=0){i++,u();let r=function(){if(i++,u(),n>=e.length)throw new Error("意外的表达式结束");const[t,r]=e[n];if("operator"===t&&ae[r]&&"prefix"===ae[r].position){n++;const t=f(ae[r].precedence);return i--,c(r,[t],"operator")}return i--,h()}(t);for(;n<e.length;){const[s,i]=e[n];if("operator"===s&&"%"===i){const s=e[n+1];if(s&&("string"===s[0]||"constant"===s[0]||"function"===s[0]||"delimiter"===s[0]&&"("===s[1])){if(ae["%"].precedence<t)break;n++;r=c("%",[r,f(ae["%"].precedence+1)],"operator")}else n++,r=c("unary%",[r],"operator");continue}if("operator"===s&&"@"===i){const s=e[n-1];if(s&&("string"===s[0]||"constant"===s[0]||"function"===s[0]||"delimiter"===s[0]&&")"===s[1])){if(ae["matmul@"].precedence<t)break;n++;r=c("matmul@",[r,f(ae["matmul@"].precedence+1)],"operator")}else{n++;r=c("@",[f(ae["@"].precedence+1)],"operator")}continue}if("operator"===s&&ae[i]&&"postfix"===ae[i].position){if(ae[i].precedence<t)break;n++,r=c(i,[r],"operator");continue}if("operator"!==s||!ae[i]||ae[i].precedence<t||"infix"!==ae[i].position)break;n++;const o=ae[i];r=c(i,[r,f(o.isCompoundAssignment?o.precedence:o.precedence+1)],"operator")}return i--,r}const g=f();if(a<o)throw new Error(`解析错误：AST节点不全(${a} < ${o})`);return function e(r,s=0){if(s>t)throw new Error("自引用检查嵌套深度过大，可能存在无限递归");if("function"===r.type){const t=r.value;if(ue[t]&&ue[t].preventSelfReference&&r.args.some((e=>"function"===e.type&&e.value===t)))throw new Error(`函数 ${t} 不能直接作用在自己身上`)}else if("operator"===r.type){const t=r.value;if(ae[t]&&ae[t].preventSelfReference&&r.args.some((e=>"operator"===e.type&&e.value===t)))throw new Error(`运算符 ${t} 不能直接作用在自己身上`)}r.args?.forEach((t=>e(t,s+1)))}(g),g}function h(t,e){return e?t.map((t=>se.convertTypes(t,e))):t.map((t=>se.convertTypes(t)))}function l(r,s,o,a,u=0){if(u>t)throw new Error("表达式求值嵌套深度过大，可能存在无限递归");if(!r)return 0;if("string"===r.type)return e.has(r.value)?e.get(r.value):se.convertTypes(r.value);if("identifier"===r.type)return e.has(r.value)?e.get(r.value):r.value;if("constant"===r.type)return ne[r.value];const c=r.args.map((t=>l(t,s,o,a,u+1)));if("operator"===r.type){const t=ae[r.value];if(void 0!==t.args&&c.length!==t.args)throw new Error(`运算符 "${r.value}" 需要 ${t.args} 个参数，但得到了 ${c.length} 个`);if(t.isCompoundAssignment){const[c,f]=r.args;if("identifier"!==c.type&&"string"!==c.type)throw new Error("赋值运算符左侧必须是变量名");!function(t,e,r,s){if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)){if(/\s/.test(t))throw new Error(`变量名 "${t}" 不能包含空格`);throw new Error(`变量名 "${t}" 格式不正确，只能包含字母、数字和下划线，且不以数字开头`)}if(t.startsWith("_cc_"))throw new Error('变量名不能以 "_cc_" 开头，这是系统保留的前缀');if(e.hasOwnProperty(t))throw new Error(`变量名 "${t}" 与运算符冲突`);if(r.hasOwnProperty(t))throw new Error(`变量名 "${t}" 与函数名冲突`);if(s.hasOwnProperty(t))throw new Error(`变量名 "${t}" 与常量冲突`);if(["if","else","true","false","null","undefined"].includes(t))throw new Error(`变量名 "${t}" 是保留字`)}(c.value,s,o,a);const g=l(f,s,o,a,u+1);if("="===r.value)return e.set(c.value,g),i(`添加变量 ${c.value}: ${g}`),"x"===c.value&&n("将无法使用x做为乘法符号"),g;{if(!e.has(c.value))throw new Error(`变量 "${c.value}" 未定义`);const r=h([e.get(c.value),g],t.argTypes),s=t.func(...r);return e.set(c.value,s),s}}const f=h(c,t.argTypes);return t.func(...f)}if("function"===r.type){const t=ue[r.value];if(void 0!==t.args)if(-1===t.args){if(0===c.length)throw new Error(`函数 "${r.value}" 至少需要1个参数`)}else if(-2===t.args);else if(c.length!==t.args)throw new Error(`函数 "${r.value}" 需要 ${t.args} 个参数，但得到了 ${c.length} 个`);const e=h(c,t.argTypes);return t.func(...e)}throw new Error(`未处理的节点类型: ${r.type}`)}return{calculate(t){o();const e=new Set(Object.keys(ae)),h=new Set(Object.keys(ue)),f=new Set(Object.keys(ne)),{expr:g,operators:m}=a(t,e),p=c(u(g,m,h,f)),w=function(t,e){if("object"==typeof(t=se.formatToDisplayString(t))&&null!==t&&(t.info&&i(t.info),t.warning&&n(t.warning),t=t.value),!e)return{value:t,info:s.length>0?s:null,warning:r.length>0?r:null};try{let n,o=e;if("operator"===o.type&&"="===o.value&&(o=o.args[1]),"function"===o.type&&ue[o.value]?n=ue[o.value].repr:"operator"===o.type&&ae[o.value]&&(n=ae[o.value].repr),"function"==typeof n)try{const e=n(t);void 0!==e&&i(e)}catch(t){throw new Error(`${t.message}`)}return{value:t,info:s.length>0?s:null,warning:r.length>0?r:null}}catch(e){return n(`格式化输出时发生错误: ${e.message}`),{value:t,info:s.length>0?s:null,warning:r.length>0?r:null}}}(l(p,e,h,f),p);return w},getASTNode(t){const e=new Set(Object.keys(ae)),r=new Set(Object.keys(ue)),s=new Set(Object.keys(ne)),{expr:n,operators:i}=a(t,e);return c(u(n,i,r,s))},getCfg:()=>({operators:new Set(Object.keys(ae)),functions:new Set(Object.keys(ue)),constants:new Set(Object.keys(ne))}),tokenize:(t,e,r,s)=>u(t,e,r,s),preprocess:(t,e,r,s)=>a(t,e),getAllVariables:()=>Object.fromEntries(e),clearAllCache(){e.clear(),o()}}}();export{ne as CONSTANTS,le as Calculator,ue as FUNCTIONS,ae as OPERATORS};
