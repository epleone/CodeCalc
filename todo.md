## TODO
- 表达式预处理时，添加半角符号的替换和其它符号（可选，ox --> 0x: 可能要考虑很多）的替换
- 如何实现在func里用其它已经定义的函数？
- 正则匹配用列表形式返回，甚至在主界面直接得到结果


## 特性
- max('1', 2)  log('1')  支持接受字符串，-- js本身支持
- 赋值运算符连用 (x = y = 1)  特性：y = (x = 1 + 2 ) **(5)


## 改进方案

让我梳理一下当前项目可能需要改进的其他方面：
- UI/UX 相关
    - 输入框的历史记录功能还没有实现
    - 移动端适配可能不够完善
    - 复制结果的提示可以做得更优雅
    - 错误提示的样式可以更友好
    - 长表达式的换行和滚动处理
- 功能完善
    - 大数运算的支持（BigInt）
    - 复杂数学函数的完善
    - 更多的字符串处理函数
    - 变量作用域的管理
    - 函数的递归调用支持
    - 测试用例
    - 测试覆盖率不够全面
    - 性能测试还未添加
    - 边界条件测试可以更完善
    - 复合函数的测试用例可以更丰富
- 代码结构
    - 代码组织可以更模块化
    - 错误处理机制可以统一
    - 类型检查可以更严格
    - 注释文档可以更完善
- 工具支持
    - AST 可视化工具可以更完善
    - 调试工具的支持
    - 性能分析工具的支持
- 其他特性
    - 国际化支持
    - 主题切换
    - 配置持久化


 各模块存在的问题：
a) 预处理模块：
功能过于集中，包含了字符串处理、括号检查、变量名检查等多个功能
建议拆分成更小的独立函数，如：
b) 词法分析模块：
shouldBeUnaryMinus 函数逻辑复杂，可以简化
collectString 函数内部逻辑可以优化
缺少对无效字符的检查
c) 语法分析模块：
缺少对表达式长度的限制
缺少对递归深度的限制
checkASTForSelfApplication 可以移到单独的验证模块
d) 求值模块：
缺少对计算结果的类型检查
缺少对计算过程中的溢出检查
缺少对计算时间的限制
e) 格式化输出模块：
需要更好的错误处理机制
可以添加更多的格式化选项
可以支持自定义格式化规则

# 添加性能监控
计算超时返回 throw new Error('计算超时');



## UI/UX 相关改进方案

这段代码实现了一个交互式计算器界面，主要功能包括：
### 输入处理系统
- 多行表达式输入
- 行间导航（上下键、Enter）
- 行编辑（删除、插入）
- 表达式计算
### 自动补全系统
- 函数名补全
- 属性函数补全
- 补全提示框显示
- 键盘导航选择

### 结果显示系统
- 计算结果展示
- 错误/警告消息显示
- 消息图标交互

### 状态管理
- 补全开关状态
- 计算缓存
- 本地存储

建议将代码拆分为以下模块：

1. 核心模块（Core）
   - ExpressionManager
     - 管理表达式行的创建、删除、插入
     - 处理行间导航
     - 协调其他模块

2. 输入处理模块（Input）
   - InputHandler
     - 键盘事件处理
     - 输入验证
     - 光标管理

3. 自动补全模块（Completion）
   - CompletionManager
     - 补全逻辑
     - 补全提示UI
     - 补全状态管理
   - CompletionProvider
     - 提供补全选项
     - 管理补全数据源

4. 结果显示模块（Output）
   - ResultRenderer
     - 结果显示逻辑
     - 错误/警告展示
     - 消息图标管理

5. UI组件模块（Components）
   - ExpressionLine
     - 单行表达式组件
   - CompletionHint
     - 补全提示框组件
   - MessageIcon
     - 消息图标组件

6. 状态管理模块（State）
   - StateManager
     - 全局状态管理
     - 本地存储处理
     - 配置管理

7. 工具模块（Utils）
   - DOMUtils
     - DOM操作辅助函数
   - EventUtils
     - 事件处理辅助函数
