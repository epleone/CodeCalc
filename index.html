<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>表达式计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        #calculator {
            margin-bottom: 20px;
        }
        #expression {
            width: 300px;
            padding: 5px;
            margin-right: 10px;
        }
        #result {
            margin: 10px 0;
            font-weight: bold;
        }
        #ast {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #examples {
            margin: 20px 0;
        }
        #examples button {
            margin: 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h1>表达式计算器</h1>
    <div id="calculator">
        <input type="text" id="expression" placeholder="输入表达式">
        <button id="calculate">计算</button>
    </div>
    <div id="examples">
        <h3>示例表达式：</h3>
    </div>
    <div id="result"></div>
    <div id="ast"></div>

    <script type="module">
        import Calculator from './calculator.js';
        import ASTVisualizer from './ast-visualizer.js';

        window.onload = function() {
            const input = document.getElementById('expression');
            const resultDiv = document.getElementById('result');
            const astDiv = document.getElementById('ast');
            const calculateBtn = document.getElementById('calculate');
            
            // 创建可视化器实例
            const visualizer = new ASTVisualizer(astDiv);

            calculateBtn.onclick = function() {
                const expr = input.value;
                try {
                    // 计算结果
                    const result = Calculator.calculate(expr);
                    resultDiv.textContent = `结果: ${result}`;

                    // 获取AST并可视化
                    const ast = Calculator.getASTNode(expr);
                    visualizer.draw(ast);
                } catch (e) {
                    resultDiv.textContent = `错误: ${e.message}`;
                    astDiv.innerHTML = '';
                }
            };

            // 添加示例表达式
            const examples = [
                "max(-1,-1-1,1, min(10, -1-1, 2))",
                "-1",
                "1 + 2",
                "2 * (3 + 4)",
                "(1 + 2) * (-3 - 4)",
                "max(1, 2, 3)",
                "1# + 2",
                "1#",
                "150°",
                "deg(150)",
                "rad(PI/2)",
                "e#"
            ];

            const examplesDiv = document.getElementById('examples');
            examples.forEach(expr => {
                const button = document.createElement('button');
                button.textContent = expr;
                button.onclick = function() {
                    input.value = expr;
                    calculateBtn.click();
                };
                examplesDiv.appendChild(button);
                examplesDiv.appendChild(document.createTextNode(' '));
            });
        };
    </script>
</body>
</html> 