<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>样式测试页面</title>
    <link rel="stylesheet" href="../src/styles.css">
    <script type="module">
        import Calculator from '../src/calculator.js';
        import * as UI from '../src/ui.js';
        const calculate = Calculator.calculate;
    </script>
    <style>
        /* 测试页面特定样式 */
        body {
            background-color: #fff;
        }
        
        .container {
            background-color: #fff;
        }
        
        .test-section {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        
        .test-description {
            margin: 10px 0;
            color: #666;
        }
        
        .copy-tip {
            margin-top: 10px;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-left: 4px solid #6c757d;
            color: #666;
            font-size: 14px;
            border-radius: 0 4px 4px 0;
            font-weight: bold;
        }
        
        .copy-tip i {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #6c757d;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-section">
            <h2>基本输入行测试</h2>
            <div class="test-description">测试表达式输入行的基本样式和布局</div>
            <div class="expression-line">
                <input type="text" class="input" value="1 + 2" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input has-value">
                        <span class="result-value">3</span>
                    </div>
                </div>
            </div>
            <div class="copy-tip">
                <i></i>点击结果可以复制到剪贴板
            </div>
        </div>

        <div class="test-section">
            <h2>消息图标测试</h2>
            <div class="test-description">测试不同类型的消息图标和提示</div>
            
            <div class="expression-line">
                <input type="text" class="input" value="sqrt(-1)" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input error">
                        <span class="result-value">sqrt函数不支持负数</span>
                    </div>
                    <div class="message-icon error" style="display: inline;">
                        <div class="message-text">sqrt函数不支持负数</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="1/0" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input error">
                        <span class="result-value">错误</span>
                    </div>
                    <div class="message-icon error" style="display: inline;">
                        <div class="message-text">除数不能为零</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="1 + +" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input error">
                        <span class="result-value">错误</span>
                    </div>
                    <div class="message-icon error" style="display: inline;">
                        <div class="message-text">表达式无效</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="a + 1" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input error">
                        <span class="result-value">错误</span>
                    </div>
                    <div class="message-icon error" style="display: inline;">
                        <div class="message-text">未定义的变量 a</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="asin(0.5)" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input has-value info">
                        <span class="result-value">0.523599</span>
                    </div>
                    <div class="message-icon info" style="display: inline;">
                        <div class="message-text">30.000000°</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="150°" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input has-value info">
                        <span class="result-value">2.617994</span>
                    </div>
                    <div class="message-icon info" style="display: inline;">
                        <div class="message-text">2.617994 弧度</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="a = 100" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input has-value info">
                        <span class="result-value">100</span>
                    </div>
                    <div class="message-icon info" style="display: inline;">
                        <div class="message-text">变量 a：100</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="b += 50" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input error">
                        <span class="result-value">错误</span>
                    </div>
                    <div class="message-icon error" style="display: inline;">
                        <div class="message-text">赋值表达式计算错误: 未定义的变量 b</div>
                    </div>
                </div>
            </div>

            <div class="expression-line">
                <input type="text" class="input" value="ob101" placeholder="输入表达式">
                <div class="result-container">
                    <div class="result has-input has-value warning">
                        <span class="result-value">5</span>
                    </div>
                    <div class="message-icon warning" style="display: inline;">
                        <div class="message-text">已显示二进制0b</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>自动补全测试</h2>
            <div class="test-description">测试输入提示和自动补全效果</div>
            <div class="expression-line">
                <input type="text" class="input" 
                       placeholder="输入表达式，试试输入 's' 然后按 Tab"
                       oninput="handleInput(event)"
                       onkeydown="handleKeyDown(event, this)">
                <div class="result-container">
                    <div class="result has-input">
                        <span class="result-value"></span>
                    </div>
                    <div class="message-icon" style="display: none;">
                        <div class="message-text"></div>
                    </div>
                </div>
            </div>
            <div class="test-description" style="margin-top: 10px;">
                提示：<br>
                1. 输入 's' 然后按 Tab 键，将自动补全为 'sin('<br>
                2. 输入 'co' 然后按 Tab 键，将自动补全为 'cos('<br>
                3. 输入 'sq' 然后按 Tab 键，将自动补全为 'sqrt('<br>
                4. 更多补全：log(, ln(, exp(, pow(, max(, min( 等
            </div>
        </div>
        <div class="copy-notification">已复制到剪贴板</div>
    </div>

    <script>
        // 初始化所有表达式的计算结果
        document.querySelectorAll('.expression-line').forEach(line => {
            const input = line.querySelector('.input');
            const resultValue = line.querySelector('.result-value');
            const messageText = line.querySelector('.message-text');
            
            if (input.value && !input.hasAttribute('oninput')) {  // 跳过自动补全测试的输入框
                try {
                    const result = calculate(input.value);
                    
                    if (typeof result === 'object') {
                        // 处理带有特殊信息的结果
                        if (result.error) {
                            resultValue.textContent = '错误';
                            messageText.textContent = result.error;
                        } else if (result.success) {
                            resultValue.textContent = result.value;
                            messageText.textContent = result.success;
                        } else if (result.warning) {
                            resultValue.textContent = result.value;
                            messageText.textContent = result.warning;
                        }
                    } else {
                        // 普通数值结果
                        resultValue.textContent = result;
                    }
                } catch (error) {
                    resultValue.textContent = '错误';
                    messageText.textContent = error.message;
                }
            }
        });

        // 为所有结果添加复制功能
        document.querySelectorAll('.result').forEach(result => {
            result.addEventListener('click', () => {
                const resultValue = result.querySelector('.result-value').textContent;
                if (resultValue.trim()) {
                    // 创建临时文本区域
                    const textarea = document.createElement('textarea');
                    textarea.value = resultValue;
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    try {
                        document.execCommand('copy');
                    } catch (err) {
                        console.error('复制失败:', err);
                    }
                    
                    document.body.removeChild(textarea);

                    // 显示复制成功提示
                    const notification = document.querySelector('.copy-notification');
                    notification.classList.add('show');
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 1000);
                }
            });
        });

        // 切换消息提示的显示
        document.querySelectorAll('.message-icon').forEach(icon => {
            icon.addEventListener('mouseover', () => {
                icon.querySelector('.message-text').style.visibility = 'visible';
                icon.querySelector('.message-text').style.opacity = '1';
            });
            icon.addEventListener('mouseout', () => {
                if (!icon.classList.contains('error')) {
                    icon.querySelector('.message-text').style.visibility = 'hidden';
                    icon.querySelector('.message-text').style.opacity = '0';
                }
            });
        });
    </script>
</body>
</html> 